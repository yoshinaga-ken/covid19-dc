const IS_SP="ontouchstart"in window||window.innerWidth<=768,D_YMD=0,D_SEX=1,D_AGE=2,D_LV=3,D_PL1=4,D_PL2=5,D_JOB=6,D_JOBCAT=7,D_CNT=8,D_OPT=9,D3_YMD=0,D3_PL1=1,D3_CNT=2,D3_TYP=3,DT_PCR=0,DT_DEA=1,DT_PAT=2,DN_SEX=0,DN_SEX_STR="不明",DN_AGE=-1,DN_AGE_STR="不明",DN_LV="",DN_LV_STR="調査中",DN_PL2="",DN_PL2_STR="不明",DN_JOB="",DN_JOB_STR="不明",DN_JOBCAT=0,DI_AGE_INFA=0,DI_AGE_LT10=1,DI_AGE_NONE=12,DI_AGE_MAX=13,CND_LV_A="無症,退院",CND_LV_B="感染",CND_LV_C="肺炎,入院",CND_LV_D="酸投,重症",CND_LV_E="死亡",COL_CND=["#2ca02c","#1f77b4","#ff7f0e","#d62728","#9467bd"],COL_CND_A=COL_CND[0],COL_CND_B=COL_CND[1],COL_CND_C=COL_CND[2],COL_CND_D=COL_CND[3],COL_CND_E=COL_CND[4],COL_NAME=colorbrewer.Set2[5],COL_AGE=d3.schemeGreens[4].slice(1).concat(d3.schemeBlues[4].slice(1)).concat(d3.schemeYlOrRd[7].slice(1)).concat(["#B0B0B0"]),CHART_DATE_STACK_GRP=[["無症,退院","感染","肺炎,入院","酸投,重症","死亡"],["S:0","S:1","S:2","S:3","S:4"],["幼児","10歳未満","10代","20代","30代","40代","50代","60代","70代","80代","90代","100代","不明"]],CHART_DATE_STACK1_N=CHART_DATE_STACK_GRP[0].length,CHART_DATE_STACK2_N=CHART_DATE_STACK_GRP[1].length,CHART_DATE_STACK3_N=CHART_DATE_STACK_GRP[2].length,DT_COL=["#20b2aa",COL_CND_E,COL_CND_B],CHART_DATE2_STACK1_N=3,CHART_DATE2_STACK2_N=6,COL_SEX=["#B0B0B0","#8dd3c7","pink"],SEX_LABEL=["不明","男性","女性"],WEEK_LABEL=moment.weekdaysMin(),IMG_NO="img/noimage.png",YMD_ED_F=[["2020-04-07","【緊急事態宣言】\n発令。７都府県\n対象：東京・埼玉・千葉・神奈川・大阪・兵庫・福岡"],["2020-04-16","【緊急事態宣言】\n対象を｢全国｣に拡大"],["2020-05-14","【緊急事態宣言】\n39県で解除\n継続：北海道・東京・埼玉・千葉・神奈川・大阪・京都・兵庫"],["2020-05-21","【緊急事態宣言】\n大阪・京都・兵庫を解除\n継続：北海道・東京・埼玉・千葉・神奈川"],["2020-05-25","【緊急事態宣言】\n全都道府県で解除"]],PREF_EN={"北海道":"hokkaido","青森県":"aomori","岩手県":"iwate","宮城県":"miyagi","秋田県":"akita","山形県":"yamagata","福島県":"fukushima","茨城県":"ibaraki","栃木県":"tochigi","群馬県":"gunma","埼玉県":"saitama","千葉県":"chiba","東京都":"tokyo","神奈川県":"kanagawa","新潟県":"niigata","富山県":"toyama","石川県":"ishikawa","福井県":"fukui","山梨県":"yamanashi","長野県":"nagano","岐阜県":"gifu","静岡県":"shizuoka","愛知県":"aichi","三重県":"mie","滋賀県":"shiga","京都府":"kyoto","大阪府":"osaka","兵庫県":"hyogo","奈良県":"nara","和歌山県":"wakayama","鳥取県":"tottori","島根県":"shimane","岡山県":"okayama","広島県":"hiroshima","山口県":"yamaguchi","徳島県":"tokushima","香川県":"kagawa","愛媛県":"ehime","高知県":"kochi","福岡県":"fukuoka","佐賀県":"saga","長崎県":"nagasaki","熊本県":"kumamoto","大分県":"oita","宮崎県":"miyazaki","鹿児島県":"kagoshima","沖縄県":"okinawa"},PREF_HIRA={"北海道":"ほっかいどう","青森県":"あおもり","岩手県":"いわて","宮城県":"みやぎ","秋田県":"あきた","山形県":"やまがた","福島県":"ふくしま","茨城県":"いばらき","栃木県":"とちぎ","群馬県":"ぐんま","埼玉県":"さいたま","千葉県":"ちば","東京都":"とうきょうと","神奈川県":"かながわ","新潟県":"にいがた","富山県":"とやま","石川県":"いしかわ","福井県":"ふくい","山梨県":"やまなし","長野県":"ながの","岐阜県":"ぎふ","静岡県":"しずおか","愛知県":"あいち","三重県":"みえ","滋賀県":"しが","京都府":"きょうとふ","大阪府":"おおさかふ","兵庫県":"ひょうご","奈良県":"なら","和歌山県":"わかやま","鳥取県":"とっとり","島根県":"しまね","岡山県":"おかやま","広島県":"ひろしま","山口県":"やまぐち","徳島県":"とくしま","香川県":"かがわ","愛媛県":"えひめ","高知県":"こうち","福岡県":"ふくおか","佐賀県":"さが","長崎県":"ながさき","熊本県":"くまもと","大分県":"おおいた","宮崎県":"みやざき","鹿児島県":"かごしま","沖縄県":"おきなわ"},PREF_IMG={"北海道":"commons/thumb/6/66/Tokachi_plain_01.jpg/560px-Tokachi_plain_01.jpg","青森県":"commons/thumb/3/3d/OiraseValley2.JPG/560px-OiraseValley2.JPG","岩手県":"commons/thumb/2/2e/Konjikido-Ooido.jpg/560px-Konjikido-Ooido.jpg","宮城県":"commons/thumb/f/fc/MatsushimaYondaikanOotakamori2.JPG/560px-MatsushimaYondaikanOotakamori2.JPG","秋田県":"ja/thumb/d/d5/Hiru_kanto_1.jpg/560px-Hiru_kanto_1.jpg","山形県":"commons/thumb/f/f8/Precincts_of_Gassan_jinja.JPG/560px-Precincts_of_Gassan_jinja.JPG","福島県":"ja/thumb/2/2a/Miharu_Miharu-Takizakura_Front_1.JPG/306px-Miharu_Miharu-Takizakura_Front_1.JPG","茨城県":"commons/thumb/d/da/Fukuroda_Falls_38.jpg/560px-Fukuroda_Falls_38.jpg","栃木県":"commons/thumb/8/88/20100727_Nikko_Tosho-gu_Yomeimon_5889.jpg/560px-20100727_Nikko_Tosho-gu_Yomeimon_5889.jpg","群馬県":"commons/thumb/8/85/Kusatsu_Yubatake_04.JPG/560px-Kusatsu_Yubatake_04.JPG","埼玉県":"ja/9/9a/Saitamanogazou.jpg","千葉県":"commons/thumb/e/e1/Photo_montage_of_Chiba.png/560px-Photo_montage_of_Chiba.png","東京都":"commons/thumb/b/bf/Tokyo_Montage_2015.jpg/560px-Tokyo_Montage_2015.jpg","神奈川県":"commons/thumb/0/06/Yokohama_MinatoMirai21.jpg/274px-Yokohama_MinatoMirai21.jpg","新潟県":"commons/thumb/a/a6/Myokousan_from_hiutiyama_1996_6_29.jpg/600px-Myokousan_from_hiutiyama_1996_6_29.jpg","富山県":"commons/thumb/b/bd/Montage_toyama_2019.png/560px-Montage_toyama_2019.png","石川県":"commons/thumb/e/ed/Montages_of_Ishikawa_prefecture.jpg/600px-Montages_of_Ishikawa_prefecture.jpg","福井県":"commons/thumb/b/bd/Japan_Tojinbo02n4592.jpg/560px-Japan_Tojinbo02n4592.jpg","山梨県":"commons/thumb/9/95/Lake_Kawaguchiko_Sakura_Mount_Fuji_3.JPG/560px-Lake_Kawaguchiko_Sakura_Mount_Fuji_3.JPG","長野県":"commons/thumb/4/4c/Mount_Shirouma_from_Mount_Korenge_2000-7-31.jpg/600px-Mount_Shirouma_from_Mount_Korenge_2000-7-31.jpg","岐阜県":"commons/thumb/e/e6/Ogi_Shirakawa-g%C5%8D%2C_Gifu%2C_Japan.jpg/560px-Ogi_Shirakawa-g%C5%8D%2C_Gifu%2C_Japan.jpg","静岡県":"ja/thumb/3/3e/MtFuji_FujiCity.jpg/560px-MtFuji_FujiCity.jpg","愛知県":"commons/thumb/1/18/Tenshuhonmaru.jpg/560px-Tenshuhonmaru.jpg","三重県":"commons/thumb/1/18/Tenshuhonmaru.jpg/560px-Tenshuhonmaru.jpg","滋賀県":"commons/thumb/1/18/Tenshuhonmaru.jpg/560px-Tenshuhonmaru.jpg","京都府":"commons/thumb/7/7c/Amanohashidate_view_from_Mt_Moju02s3s4592.jpg/300px-Amanohashidate_view_from_Mt_Moju02s3s4592.jpg","大阪府":"commons/thumb/c/ca/Osaka_Castle_03bs3200.jpg/318px-Osaka_Castle_03bs3200.jpg","兵庫県":"commons/thumb/a/a7/Kobe_Port_Tower03bs3200.jpg/480px-Kobe_Port_Tower03bs3200.jpg","奈良県":"commons/thumb/2/2f/T%C5%8Ddai-ji_Kon-d%C5%8D.jpg/560px-T%C5%8Ddai-ji_Kon-d%C5%8D.jpg","和歌山県":"commons/thumb/1/17/Danjogaran_Koyasan12n3200.jpg/560px-Danjogaran_Koyasan12n3200.jpg","鳥取県":"commons/thumb/e/e1/Tottori-Sakyu_Tottori_Japan.JPG/560px-Tottori-Sakyu_Tottori_Japan.JPG","島根県":"commons/thumb/7/73/Izumo-taisha16nt3200.jpg/560px-Izumo-taisha16nt3200.jpg","岡山県":"commons/thumb/4/4b/Okayama_Korakuen_Garden01.jpg/560px-Okayama_Korakuen_Garden01.jpg","広島県":"commons/thumb/d/da/Montages_of_Hiroshima_prefecture.jpg/560px-Montages_of_Hiroshima_prefecture.jpg","山口県":"ja/thumb/7/7e/%E7%A7%8B%E5%90%89%E5%8F%B0%E9%A2%A8%E6%99%AF.JPG/560px-%E7%A7%8B%E5%90%89%E5%8F%B0%E9%A2%A8%E6%99%AF.JPG","徳島県":"commons/thumb/2/29/Onaruto-bridge_and_Naruto_Channel%2CNaruto-city%2CJapan.JPG/560px-Onaruto-bridge_and_Naruto_Channel%2CNaruto-city%2CJapan.JPG","香川県":"commons/thumb/8/8b/%E9%A6%99%E5%B7%9D%E7%9C%8C%E3%81%AE%E9%A2%A8%E6%99%AF.jpg/560px-%E9%A6%99%E5%B7%9D%E7%9C%8C%E3%81%AE%E9%A2%A8%E6%99%AF.jpg","愛媛県":"commons/thumb/8/83/D%C5%8Dgo_Onsen.jpg/560px-D%C5%8Dgo_Onsen.jpg","高知県":"ja/thumb/c/c1/Shimanto_River_And_Iwama_Bridge_1.JPG/560px-Shimanto_River_And_Iwama_Bridge_1.JPG","福岡県":"commons/thumb/8/8b/20100719_Dazaifu_Tenmangu_Shrine_3328.jpg/560px-20100719_Dazaifu_Tenmangu_Shrine_3328.jpg","佐賀県":"commons/thumb/3/38/Yoshinogari-iseki_zenkei.JPG/560px-Yoshinogari-iseki_zenkei.JPG","長崎県":"commons/thumb/a/a4/Nagasaki-Glover-Garden-5415.jpg/560px-Nagasaki-Glover-Garden-5415.jpg","熊本県":"ja/thumb/a/a1/20140516%E9%98%BF%E8%98%87%E5%B1%B1%E5%BA%83%E5%9F%9F.jpg/560px-20140516%E9%98%BF%E8%98%87%E5%B1%B1%E5%BA%83%E5%9F%9F.jpg","大分県":"commons/thumb/a/af/Beppu_Umi-jigoku04n4272.jpg/560px-Beppu_Umi-jigoku04n4272.jpg","宮崎県":"commons/thumb/5/51/Takachihokyou55.jpg/560px-Takachihokyou55.jpg","鹿児島県":"ja/thumb/a/ac/Kagoshima_and_Sakurajima.jpg/560px-Kagoshima_and_Sakurajima.jpg","沖縄県":"commons/thumb/9/99/Naha_Shuri_Castle16s5s3200.jpg/560px-Naha_Shuri_Castle16s5s3200.jpg"},PREF_IMG_PATH="https://upload.wikimedia.org/wikipedia/",JOB_HIRA={"無職":"むしょく","教職員":"きょうしょくいん","学生":"がくせい","保育園児":"ほいくえんじ","入所者":"にゅうしょしゃ","医師":"いし","看護師":"かんごし","看護職員":"かんごしょくいん","医療従事者":"いりょうじゅうじしゃ","介護職員":"かいごしょくいん","福祉事業従事者":"ふくしじぎょうじゅうじしゃ","保育園職員":"ほいくえんしょくいん","歯医者勤務":"はいしゃきんむ","公務員":"こうむいん","団体職員":"だんたいしょくいん","自衛・消防官":"じえいしょうぼうかん","経営者・役員":"けいえいしゃやくいん","会社員":"かいしゃいん","事務職員":"じむしょくいん","運転手":"うんてんしゅ","運送業":"うんそうぎょう","接客業":"せっきゃくぎょう","飲食業":"いんしょくぎょう","飲食店従業員":"いんしょくてんじゅうぎょういん","自営業":"じえいぎょう","パート・アルバイト":"パートアルバイト","サービス業":"さーびすぎょう","製造業":"せいぞうぎょう","土木建築業":"どぼくけんちくぎょう","スポーツ選手":"スポーツせんしゅ"},LV_HIRA={"退院":"たいいん","無症状":"むしょうじょう","重症":"じゅうしょう","死亡":"しぼう","軽症":"けいしょう","中等度":"ちゅうとうど","肺炎入院":"はいえんにゅういん","入院予定":"にゅういんよてい","入院":"にゅういん","肺炎":"はいえん","自宅待機":"じたくたいき","酸投":"さんとう","肺炎入院予定":"はいえんにゅういんよてい","再発入院":"さいはつにゅういん"},SPARK_SX=IS_SP?60:25,MAP_COL_TBL=[["1000人以上","#8c0a00"],["500人以上","#ea5432"],["100人以上","#ff781d"],["50人以上","#ff9d57"],["10人以上","#ffceab"],["1人以上","#f5deb3"],["0人","#dadada"],["選択中","#ffffff"]];colorbrewer.Set3[12][8]=colorbrewer.Set2[8][6],colorbrewer.Set2[8][7]=colorbrewer.Set1[8][6];const m_={config:{url_param_data_replace:!IS_SP,cDateYm:{is_elasticY:1},cJob:{TD:750,barWidth:40}},get:location_get_query(),url_data:{path:"data/",assets:"covid19-assets.json",data:"covid19-data.json"},url_name:"https://ja.wikipedia.org/wiki",composite:null,chartDate:null,chartLine:null,composite2:null,chartDate2:null,chartLine2:null,chartName:null,chartCity:null,chartSex:null,chartWeek:null,chartAge:null,chartCond:null,chartJob:null,ndx:{},data_type:1,data_hdr:[],data:[],names:{},citys:[],conds:[],jobcates:[],data3:[],pref_tbl_last_m1:[],pref_tbl_last_m2:[],pref_tbl_last_cnt:{},spk:{},ac_data:[],ac_data_tbl:[],dimJob:null,dimJobCat:null,dimName:null,gpName:null,gpName_all:{},dimName2:null,domainDate:null,gpDate:null,gpDate2:null,chartDate2Mode:0,gpJob:null,is_job_cate:1,gpJobCat:null,dateCnt:{},datePick:null,dateCntMax:0,dateCntTo:"YYYYMMDD",dateCntMax2:0,dateCntTo2:"YYYYMMDD",tab:null,sel_tab:"tabs_c",sel_stack:"con",tip:null,tipRow:null,tbl_pref:null,tbl_pref_isearch:null,settings_name:"",settings:null,chartAllFilterByKW_render:0,line:d3.line().curve(d3.curveLinear),last_fth:"",is_drawJapanMap:1,is_filter_region_sel:0,group_reduce:{add:function(e,t,a){const n=a*(t[8]||1);e=m_.group_reduce_lv_set(e,t[3],n);let r=t[4];return void 0===e.nmcnt[r]&&(e.nmcnt[r]=0),e.nmcnt[r]+=n,(e=m_.group_reduce_age_set(e,t[2],n)).total+=n,e},append:(e,t)=>m_.group_reduce.add(e,t,1),remove:(e,t)=>m_.group_reduce.add(e,t,-1),init:(e,t)=>({lv_a:0,lv_b:0,lv_c:0,lv_d:0,lv_e:0,nmcnt:{},agcnt:[0,0,0,0,0,0,0,0,0,0,0,0,0],total:0})},group_reduce_light:{add:function(e,t,a){const n=a*(t[8]||1),r=t[3];return(e=m_.group_reduce_lv_set(e,r,n)).total+=n,e},append:(e,t)=>m_.group_reduce_light.add(e,t,1),remove:(e,t)=>m_.group_reduce_light.add(e,t,-1),init:function(e,t){return{lv_a:0,lv_b:0,lv_c:0,lv_d:0,lv_e:0,total:0}}},date_stk_nm:[],dateCntCreate:function(){m_.dateCnt={},m_.dateCntMax=-1,m_.dateCntTo="00000000",_.forEach(m_.gpDate.all(),e=>{let t=moment(e.key).format("YYYYMMDD");m_.dateCnt[t]=e.value,e.value>m_.dateCntMax&&(m_.dateCntMax=e.value),e.value>0&&t>m_.dateCntTo&&(m_.dateCntTo=t)})},settingsLoad:function(){m_.settings_name="covid19"+function(e){let t=e.split("/");return t.slice(0,t.length-1).join("/")}(location.pathname),m_.settings=JSON.parse(localStorage.getItem(m_.settings_name)),void 0!==m_.get.light&&$("#ch_pnl_week").prop("checked",!0)},ageTickFormat:function(e){return 1===e?"幼児":-1===e?"不明":0===e?"10歳未満":e+"代"},getChartnameTitle:function(e,t){let a=m_.pref_tbl_last_m1[e];if(void 0===a)return"";let n=m_.names[e]?m_.names[e]:0,r=n-a.discharged-a.deaths;return ret=e+t+"総人口　: "+php_number_format(a.n)+"名"+t+"感染者数: "+php_number_format(n)+"名 ("+_.round(100*n/a.n,3)+"%)"+t+"患者数　: "+php_number_format(r)+"名"+t+"PCR検査: "+php_number_format(a.pcrtested)+"名 ("+a.pcrtested_p+"%)"+t+"死亡者数: "+a.deaths+"名"+t+"退院者数: "+php_number_format(a.discharged)+"名"+t+"対策病床数: "+php_number_format(a.bed)+"床 ("+_.round(100*r/a.bed,2)+"%)"+t,ret},getFilterTxt:function(){let e=$("#panel_name .filter_txt").val(),t=$("#panel_city .filter_txt").val(),a=$("#panel_date .filter_txt").val(),n=$("#chart_week .filter").text(),r=$("#chart_age .filter").text(),o=$("#chart_sex .filter").text(),l=m_.chartCond.filters().join(","),c=m_.chartJob.filters().join(","),s=_.fill(Array(8),"");const m="と";if(""!==e){let t="",a=e.split(",");for(i of a)t+=i.trim()+m;s[1]=(1==a.length?"":"【")+php_trim(t,m)+(1==a.length?"":"】")}if(""!==t){let e=-1!==t.indexOf(",");s[2]=(e?"【":"")+t+(e?"】":"")}if(""!=a&&m_.chartDate.filters().length)if(m_.chartDate.brushOn())s.push(a);else{let e="",t=a.split(",");for(i of t)e+=i+m;s[0]=(1==t.length?"":"【")+php_trim(e,m)+(1==t.length?"":"】")}if(""!=n){let e=-1!==n.indexOf(",");s[3]="曜日:"+(e?"【":"")+n+(e?"】":"")}if(""!=r){let e="",t=r.split(",");for(i of t)e+=m_.ageTickFormat(+i)+m;s[4]="年齢:"+(1==t.length?"":"【")+php_trim(e,m)+(1==t.length?"":"】")}if(""!=o){let e="",t=o.split(",");if(3!==t.length){for(i of t)e+=i.trim()+m;s[5]="性別:"+(1==t.length?"":"【")+php_trim(e,m)+(1==t.length?"":"】")}}if(""!=l){let e=-1!==l.indexOf(",");s[6]="状態:"+(e?"【":"")+l+(e?"】":"")}if(""!=c){let e=-1!==c.indexOf(",");s[7]="職業:"+(e?"【":"")+c+(e?"】":"")}return s},chartNameFilters:function(e){let t=_.keys(m_.names),a=[];for(i of e)-1!==_.indexOf(t,i)&&a.push(i);if(0===a.length)return m_.chartName.filterAll(),void m_.renderAllChart();let n=m_.chartName.filters();diff=a.length>n.length?_.difference(a,n):_.difference(n,a),m_.chartName.filter(diff[0]),m_.renderAllChart()},chartAllFilterByKW:function(e){if(!isNaN(e[0])){let t=moment(e);if(t.isValid()){let e=t.format("YYYY-MM-DD");if(-1!==e.indexOf("2001")){let a=e.split("-");t=moment("2020-"+a[1]+"-"+a[2])}return m_.composite.filterAll().filter(t.toDate()),m_.renderAllChart(),m_.barChartRedrawGroup(m_.chartDate),1}}if(-1!==_.indexOf(m_.jobcates,e))return m_.chartJob.filterAll().filter(e),m_.renderAllChart(),1;if(-1!==_.indexOf(m_.conds,e))return m_.chartCond.filterAll().filter(e),m_.renderAllChart(),1;let t=_.keys(m_.names),a="",n=0;const r=/\s+/;let i=[];for(pre1 of e.split(r))for(nm of t)pre1===nm&&(0===i.length&&(a=pre1.replace(nm,"")),i.push(nm),n=1);if(n)return m_.chartName.filterAll().filter(1===i.length?i[0]:[i]),m_.chartCity.filterAll(),m_.renderAllChart(),m_.chartScroll("#div_name",i[0],300),1;for(nm of(a=e,t))0===e.indexOf(nm)&&(a=e.replace(nm,""));if(""===a)return 0;let o=_.filter(m_.citys,e=>0===e.indexOf(a));return o.length?(m_.chartName.filterAll(),m_.chartCity.filterAll().filter([o]),m_.renderAllChart(),$("#ch_pnl_city").prop("checked",!0).trigger("ch_pnl_update"),m_.chartScroll("#div_city",a,300),1):0},parseURLParams:function(){let e;if(m_.get.name){let t=m_.get.name.split(" "),a=1===t.length?t[0]:[t];m_.chartName.filterAll().filter(a),$("#btn_search").val(t.join(" ")),drawJapanMap(),e=0}if(m_.get.q&&($("#btn_search").val(m_.get.q.trim()),e=1),m_.get.date){const e=e=>{let t,a=e.split("-");switch(a.length){case 3:t=moment(a[0]+"-"+printf02d(a[1])+"-"+printf02d(e[2]));break;case 2:t=moment(moment().format("YYYY")+"-"+printf02d(a[0])+"-"+printf02d(a[1]));break;case 1:t=e}return t};let t,a,n=m_.get.date.split(" "),r=0;switch(n.length){case 1:t=e(n[0]),isNaN(parseInt(t))&&(r=dc.filters.RangedFilter(t.toDate(),t.add(1,"days").toDate()));break;case 2:t=e(n[0]),a=e(n[1]),r=isNaN(parseInt(a))?dc.filters.RangedFilter(t.toDate(),a.toDate()):dc.filters.RangedFilter(t.toDate(),t.add(a,"days").toDate())}r&&(m_.composite.brushOn(!0).render(),m_.composite.filter(r),$(".btn_brush").trigger("my_update",0))}e&&$("#btn_search").trigger("btn_search_update")},showFilterUi:function(e,t,a){let n=t.filters(),r=$(e);if(n.length){if($.isArray(n[0])){let e=a(n[0][0])+"～"+a(n[0][1]);r.find(".filter_txt").show().val(e).attr("title",e),r.find(".filter_txt_diff").text(moment(n[0][1]).diff(n[0][0],"days")+1+"日間")}else{let e=[];for(f of n)a&&(f=a(f)),e.push(f);let t=e.join(",");r.find(".filter_txt").show().val(t).attr("title",t),r.find(".filter_txt_diff").text("")}r.find(".reset_btn").show()}else r.find(".filter_txt").hide(),r.find(".reset_btn").hide()},mapSetSelectedRegions:function(){let e=m_.chartName.filters();if(e.length&&map){m_.is_filter_region_sel=1,map.clearSelectedRegions(),sels=[];for(var t=0;t<e.length;t++)sels[t]=_.capitalize(PREF_EN[e[t]]);map.setSelectedRegions(sels),m_.is_filter_region_sel=0}},renderVLine:function(e,t){e.g().select("g.chart-body").selectAll("path.line").data(t).enter().append("path").attr("class",function(e){return e.cls.concat(["line"]).join(" ")}).attr("d",function(t){let a=e.x()(t.x);return m_.line([[a,e.y().range()[0]],[a,e.y().range()[1]]])})},barChartRedrawGroup:function(e){let t=e.selectAll("rect.bar");if(0==t.size())return;let a=e.filters();0==a.length?t.classed("deselected",!1).classed("selected",!0):(t.classed("deselected",!0).classed("selected",!1),t.each(function(e){for(var t=0;t<a.length;t++)moment(e.x).isSame(a[t])&&$(this).removeClass("deselected").addClass("selected")}))},addFilterHandlerSingle:function(e,t){return window.event&&(window.event.ctrlKey||window.event.shiftKey)?(e.push(t),e):[t]},addFilterHandlerSingleR:function(e,t){return window.event&&(window.event.ctrlKey||window.event.shiftKey)?[t]:(e.push(t),e)},on_chartDate_pretransition:function(e){let t=e.chartID(),a=m_.composite.chartID()===t,n=m_.chartName.filters(),r=n.length>1;if(a){m_.chartLegendUpdate(e),$("#chart_date g.dc-legend-item").filter(':contains("週間")').show().attr("transform","translate(90,0)")}else{let e=$("#chart_date2 g.dc-legend-item");if(r)for(var i=0;i<n.length;i++)e.filter(':contains("'+n[i]+'")').show();else for(i=0;i<n.length;i++)e.filter(':contains("'+n[i]+'")').show()}if(m_.data_type&&m_.renderVLine(e,[{cls:["s1"],x:new Date(YMD_ED_F[0][0])},{cls:["s2"],x:new Date(YMD_ED_F[1][0])},{cls:["s2"],x:new Date(YMD_ED_F[2][0])},{cls:["s2"],x:new Date(YMD_ED_F[3][0])},{cls:["s3"],x:new Date(YMD_ED_F[4][0])}]),!a)return;e.selectAll("rect.bar").on("click",function(t){e.filter(t.data.key).redrawGroup(),m_.barChartRedrawGroup(e)}),m_.is_drawJapanMap&&drawJapanMap(),m_.is_drawJapanMap=1;let o=m_.getFilterTxt();fth=o.join(" ").trim(),$(".hdr_flt").text((""===fth?"全国":fth)+"の状況"),void 0!==m_.get.light&&$("head title").text((""===fth?"全国":fth)+"の状況 - 新型コロナウイルス感染状況"),"tabs_c"===m_.sel_tab&&(o[1]="",fth=o.join(" ").trim(),$(".hdr_flt_map").text(""===fth?"":fth+"の状況")),o[2]="",o[0]="",fth=o.join(" ").trim(),""!==fth?(m_.last_fth!==fth&&$("#chk_tbl_spkflt").checkboxradio({label:'<i class="fa fa-filter"></i>['+fth+" ]"+(IS_SP?"<BR>":"")+"でフィルタ"}).prop("checked",!0).trigger("click"),$("#chk_tbl_spkflt_l").show()):$("#chk_tbl_spkflt_l").hide(),m_.last_fth=fth,$("#cnt_all").text(php_number_format(m_.ndx.groupAll().reduceSum(e=>e[8]||1).value()));let l=m_.gpDate.all();if(l.length>=1){let e,t;for(i=l.length-1;i>=0&&0===l[i].value;i--);e=l[i],t=l[i-1],e&&($("#cnt_day").text(moment(e.key).format("YYYY/M/D(ddd)")+"時点"),h=e.value-t.value,$("#cnt_one").text((h>=0?"+":"")+php_number_format(h)))}else $("#cnt_one").text(""),$("#cnt_day").text("")},on_chart_filtered:function(e,t){let a=e.chartID();if(e.filters().length&&$("#ui-datepicker-div").is(":visible")&&m_.datePick.datepicker("show"),(a===m_.chartName.chartID()||a===m_.chartCity.chartID()||a===m_.chartDate.chartID())&&m_.is_job_cate){let e=m_.chartName.filters(),t=m_.chartCity.filters(),a=m_.chartDate.filters();if(e.length||t.length||a.length){""===$("#chart_job_title_sub").text()&&($("#chart_job_title_sub").text("(詳細)"),m_.chartJob.dimension(m_.dimJob).group(m_.gpJob).render())}else{"(詳細)"===$("#chart_job_title_sub").text()&&($("#chart_job_title_sub").text(""),m_.chartJob.dimension(m_.dimJobCat).group(m_.gpJobCat).render())}}a===m_.chartName.chartID()&&(m_.chartCity.filterAll(),m_.mapSetSelectedRegions()),$(".jvectormap-tip").hide()},on_chart_postRedraw:function(e){e.transitionDuration(m_.config.cJob.TD),e.render()},chartDateLegendUpdate2:function(){let e=0!==m_.chartName.filters().length;m_.composite2.legend().y(e?-30:0)},renderAllChart:function(){m_.config.cDateYm.is_elasticY||m_.chartDate.y(d3.scaleLinear().domain([0,_.max(_.map(m_.gpDate.all(),"value"))+10])),dc.renderAll("chartGroup"),m_.on_chart_postRedraw(m_.chartJob),IS_SP&&(d3.selectAll(".pie-slice").call(m_.tip),d3.selectAll(".pie-slice").on("mouseover",m_.tip.show).on("mouseout",m_.tip.hide),d3.selectAll(".bar").call(m_.tip),d3.selectAll(".bar").on("mouseover",m_.tip.show).on("mouseout",m_.tip.hide))},groupRemoveEmpty:function(e){return{all:function(){return e.all().filter(function(e){return 0!=e.value})}}},group_reduce_age_set(e,t,a){switch(t){case-1:e.agcnt[12]+=a;break;case 1:e.agcnt[0]+=a;break;case 0:e.agcnt[1]+=a;break;default:e.agcnt[t/10+1]+=a}return e},group_reduce_lv_set(e,t,a){for(;;){if(-1!==t.indexOf("死亡")){e.lv_e+=a;break}if(-1!==t.indexOf("酸投")||-1!==t.indexOf("重症")){e.lv_d+=a;break}if(-1!==t.indexOf("入院")||-1!==t.indexOf("肺炎")||-1!==t.indexOf("中等")){e.lv_c+=a;break}if(-1!==t.indexOf("無症状")||-1!==t.indexOf("退院")){e.lv_a+=a;break}e.lv_b+=a;break}return e},chartLegendUpdate:function(e){let t=e.legendables(),a=e.legend()._legendItemHeight(),n=$(e.anchor()).find("g.dc-legend-item"),r=0;t.forEach((e,t)=>{n.eq(t).attr("transform",`translate(${e.hidden?-100:0},${e.hidden?-100:r*a})`),r+=e.hidden?0:1})},dateStakShow:function(e){for(var t=0;t<CHART_DATE_STACK_GRP.length;t++)for(var a=0;a<CHART_DATE_STACK_GRP[t].length;a++)t===e?m_.chartDate.showStack(CHART_DATE_STACK_GRP[t][a]):m_.chartDate.hideStack(CHART_DATE_STACK_GRP[t][a])},dateStack2Accessor:function(e,t){return function(e,a){let n=m_.chartName.filters();return n.length>1&&n.length<=CHART_DATE_STACK2_N?(m_.date_stk_nm[t]=n[t],void 0===e.value.nmcnt[n[t]]?0:e.value.nmcnt[n[t]]):(m_.date_stk_nm[t]="(選択"+(t+1)+")",0)}},dateStack3Accessor:function(e){return function(t,a){return t.value.agcnt[e]}},chartScroll:function(e,t,a){t=t||"",a=void 0===a?300:a;let n=$(e);if(""==t)return void n.scrollTop(0);let r=n.find('g.row:contains("'+t+'")');if(r.length){let e;if(IS_SP)e=r.attr("transform").replace(")","").split(",")[1]-40;else{let t=n.find("g.row:eq(0)").position();e=r.position().top-t.top-40}0===a?n.scrollTop(e):n.animate({scrollTop:e},a,"swing")}},createFilteredBarStacksData:function(){let e=_.keys(PREF_EN),t=m_.chartName.dimension();m_.chartDate.x(d3.scaleTime().domain([moment(m_.spk.min_ymd).toDate(),moment(m_.spk.max_ymd).toDate()]));let a=[],n=m_.chartDate.group();for(var r=0;r<e.length;r++)t.filter(e[r]),a[r]=[],_.forEach(n.all(),e=>{let t=moment(e.key).format("YYMD");a[r][t]=[e.value.lv_a,e.value.lv_b,e.value.lv_c,e.value.lv_d,e.value.lv_e]});let i=[],o=moment(m_.spk.min_ymd),l=moment(m_.spk.max_ymd).diff(o,"days");for(r=0;r<e.length;r++){i[r]=[],o=moment(m_.spk.min_ymd);for(var c=0;c<=l;c++){let e=0==c?o.format("YYMD"):o.add(1,"days").format("YYMD");void 0!==a[r][e]?i[r][c]=a[r][e]:i[r][c]=[0,0,0,0,0]}i[r]=i[r].slice(SPARK_SX)}return t.filterAll(),m_.domainDate&&m_.chartDate.x(d3.scaleTime().domain(m_.domainDate)),i},getPrefCntTbl:function(){let e={};switch(m_.sel_tab){case"tabs_c":let a=m_.gpName.all();for(var t=0;t<a.length;t++)e[a[t].key]=a[t].value;break;case"tabs_p":_.forEach(m_.pref_tbl_last_m1,(t,a)=>{let n=(m_.names[a]?m_.names[a]:0)-t.discharged-t.deaths;e[a]=n});break;case"tabs_pc":_.forEach(m_.pref_tbl_last_m1,(t,a)=>{e[a]=t.pcrtested,e[a]=2500*t.pcrtested_p});break;case"tabs_d":_.forEach(m_.pref_tbl_last_m1,(t,a)=>{e[a]=t.deaths});break;case"tabs_b":_.forEach(m_.pref_tbl_last_m1,(t,a)=>{e[a]=t.bed})}return e},loadDcData:e=>{m_.get.data=e;const t=()=>{let e=Object.assign({},m_.get);delete e.data,e.date&&(e.date=e.date.replace(" ","+"));let t="data="+m_.get.data.replace(/\?.*$/,"")+(_.size(m_.get)>1?"&"+php_http_build_query(e):"");if(-1!==location.href.indexOf("?")||-1!==location.href.toLowerCase().indexOf(".html"))t=location.pathname+"?"+t;else{t=(e=>(-1===location.pathname.indexOf("=")?e+="/"===_.last(e)?"":"/":e=e.substr(0,e.lastIndexOf("/")+1),e))(location.pathname)+t}history.replaceState(null,null,t)};let a,n="csv"===(e=>(e=e.replace(/\?.*$/,"")).substr(e.lastIndexOf(".")+1))(m_.get.data).toLowerCase(),r=-1!==m_.get.data.indexOf("http")?m_.get.data:m_.url_data.path+m_.get.data;return r+="",a=n?d3.csv(r,e=>{let t=Object.values(e);return t[1]=parseInt(t[1]),t[2]=parseInt(t[2]),t[7]=parseInt(t[7]),t[8]=parseInt(t[8]),t}).then(e=>{e.unshift(e.columns),initDc(e)}).then(()=>{m_.config.url_param_data_replace&&t()}):d3.json(r).then(initDc).then(()=>{m_.config.url_param_data_replace&&t()})},loadAllData:()=>{const e="file:"===location.protocol;m_.composite=new dc.CompositeChart("#chart_date","chartGroup"),m_.chartDate=new dc.BarChart(m_.composite),m_.chartLine=new dc.LineChart(m_.composite),m_.composite2=new dc.CompositeChart("#chart_date2","chartGroup"),m_.chartDate2=new dc.BarChart(m_.composite2),m_.chartLine2=new dc.LineChart(m_.composite2),m_.chartName=new dc.RowChart("#chart_name","chartGroup"),m_.chartCity=new dc.RowChart("#chart_city","chartGroup"),m_.chartSex=new dc.PieChart("#chart_sex","chartGroup"),m_.chartWeek=new dc.BarChart("#chart_week","chartGroup"),m_.chartAge=new dc.BarChart("#chart_age","chartGroup"),m_.chartCond=new dc.BarChart("#chart_cond","chartGroup"),m_.chartJob=new dc.BarChart("#chart_job","chartGroup");const t=t=>{if(m_.data3=t.data3,m_.jobcates=t.jobcates,m_.pref_tbl_last_m1=t.pref_tbl_last_m1,m_.pref_tbl_last_m2=t.pref_tbl_last_m2,m_.spk=t.spk,m_.ac_data=t.ac_data,m_.ac_data_tbl=t.ac_data_tbl,m_.init(),!e){let e=m_.get.data||m_.url_data.data;m_.loadDcData(e)}};e?(t(g_covid19_assets),initDc(g_covid19_data)):d3.json(m_.url_data.path+m_.url_data.assets).then(t)},reLoadDcData:function(e){m_.ndx.remove(),m_.ndx=null,m_.get={},m_.loadDcData(e).then(()=>{$(".btn_clear_all").trigger("click")})},init:function(){IS_SP&&(m_.tip=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(){return $(this).find("title").text().replace(/\n/g,"<BR>")})),initAutoComplete(),$("#btn_search").autocomplete_ex({user_opt:{data:m_.ac_data,multiple:1,select:function(e,t){if("職業"===t.item[0]||"状態"===t.item[0])$("#btn_search").val(t.item[1]).trigger("btn_search_update");else{let e=$("#btn_search");const a=/\s+/;if(1===e.val().trim().split(a).length){let a=t.item[0]===t.item[1];e.val((a?t.item[0]:t.item[0]+t.item[1])+" ")}e.trigger("btn_search_update")}}}}),void 0===m_.get.light&&initPrefTable()}},initDc=e=>{if(m_.data_hdr=e.shift(),m_.data=e,m_.data_hdr[9]){let e={};php_parse_str(m_.data_hdr[9],e),m_.data_type=parseInt(e.data_type)}else m_.data_type=0;if(m_.data_type)m_.domainDate=[moment("2020-03-20").subtract(1,"days").toDate(),moment(m_.spk.max_ymd).add(3,"days").toDate()];else{let e=_.uniq(_.map(m_.data,0));m_.domainDate=[moment(_.min(e)).subtract(1,"days").toDate(),moment(_.max(e)).add(3,"days").toDate()]}const t=_.map(e,4),a=_.uniq(t).length;m_.names=_.countBy(t),m_.citys=_.uniq(_.map(e,5)),m_.conds=_.uniq(_.map(e,3));let n=crossfilter(m_.data);m_.ndx=n;let r=crossfilter(m_.data3);m_.dimName=n.dimension(function(e){return e[4]}),m_.gpName=m_.dimName.group().reduceSum(function(e){return e[8]||1}),m_.gpName.all().forEach(e=>m_.gpName_all[e.key]=e.value),m_.dimName2=r.dimension(function(e){return e[1]}),m_.chartName.width(IS_SP?parseInt(window.innerWidth/2)+15:205).titleLabelOffsetX(50).height(24+29*a).fixedBarHeight(24).margins({top:0,left:10,right:10,bottom:20}).transitionDuration(750).dimension(m_.dimName).group(m_.groupRemoveEmpty(m_.gpName)).addFilterHandler(m_.addFilterHandlerSingleR).on("filtered",function(e,t){let a=e.filters();if("age"!==m_.sel_stack){a.length>1&&a.length<=CHART_DATE_STACK2_N?(m_.dateStakShow(1),$("#stack_type_pre").prop("checked",!0)):(m_.dateStakShow(0),$("#stack_type_con").prop("checked",!0))}$("#detail_div1,#detail_div2,#detail_div3,#detail_div4,#detail_div5").hide();const n=m_.names["東京都"];for(var r=0;r<a.length;r++){let e=r+1,t=a[r],i=m_.pref_tbl_last_m1[t];if(void 0===i)continue;let o=m_.names[t]?m_.names[t]:0,l=o-i.discharged-i.deaths,c='<img src="img/japan/'+PREF_EN[t]+'.gif">',s=parseInt(100*o/n),m="background: linear-gradient(to right, rgb(31, 119, 180, 0.3) "+s+"%, #fffacd "+s+"%, #fffacd "+(100-s)+"%) center center / 100% 100% no-repeat;",d="<B>"+c+'<a target="_blank" title="'+t+'の wikipediaへ" href="'+m_.url_name+"/"+t+'">'+t+'</a></B><BR><img style="width:180px;height:120px;object-fit: cover;object-position:0% 0%;" src="'+PREF_IMG_PATH+PREF_IMG[t]+'"><BR>'+(void 0===i?"なし<BR>":"<table><tbody><tr><td>総人口　:</td><td>"+php_number_format(i.n)+'名</tr><tr><td>感染者数:</td><td style="'+m+'"> '+php_number_format(o)+'名 <a title="人口に対する感染者率。感染者数 ÷ 総人口。">('+_.round(100*o/i.n,3)+"%)</a></td></tr><tr><td>患者数　:</td><td> "+php_number_format(l)+"名</td></tr><tr><td>PCR検査:</td><td> "+php_number_format(i.pcrtested)+'名 <a title="人口に対するPCR検査率。PCR検査数 ÷ 総人口。">('+i.pcrtested_p+"%)</a></td></tr><tr><td>死亡者数:</td><td> "+i.deaths+"名</td></tr><tr><td>退院者数:</td><td> "+php_number_format(i.discharged)+"名<BR><tr><td>対策病床数:</td><td> "+php_number_format(i.bed)+'床 <a title="対策病床使用率。患者数/対策病床数。">('+_.round(100*l/i.bed,2)+"%)</a></td></tr></tbody></table>")+'<a target="_blank" href="https://hazard.yahoo.co.jp/article/covid19'+PREF_EN[t]+'">'+t+"コロナまとめサイト</a>";$("#detail_div"+e).html(d).hide().show()}$("#tbl_flt").val(a.join(" ")).trigger("change"),m_.showFilterUi("#panel_name",e),m_.dateCntCreate(),m_.on_chart_filtered(e,t)}).on("pretransition",function(e){e.selectAll("text.row").attr("x",32),e.selectAll("rect").attr("x",28),e.selectAll("g.row").append("svg:image").attr("width","26").attr("class","pl").attr("xlink:href",function(e,t){return PREF_EN[e.key]?"img/japan/"+PREF_EN[e.key]+".gif":IMG_NO}).on("click",function(e){next=m_.url_name+"/"+e.key,window.open(next)})}).ordinalColors(colorbrewer.Set2[8]).renderLabel(!0).label(function(e){s=e.key;for(var t=0;t<4-e.key.length;t++)s+="　";s+=" ";let a=m_.gpName_all[e.key]!==e.value;return s+php_number_format(e.value)+(a?"":m_.pref_tbl_last_cnt[e.key]?"▲"+m_.pref_tbl_last_cnt[e.key]:"")}).renderTitleLabel(!1).title(function(e){let t=m_.getChartnameTitle(e.key,"\n");return""===t?e.value:t}).elasticX(!0),m_.chartName.xAxis().ticks(0);let o=n.dimension(function(e){return e[5]}),l=o.group().reduceSum(function(e){return""===e[5]?0:e[8]||1});m_.chartCity.width(IS_SP?parseInt(window.innerWidth/2)-30:190).height(24+29*Object.keys(l.all()).length).fixedBarHeight(24).margins({top:0,left:10,right:10,bottom:20}).transitionDuration(750).dimension(o).group(m_.groupRemoveEmpty(l)).addFilterHandler(m_.addFilterHandlerSingleR).ordinalColors(colorbrewer.Paired[9]).renderLabel(!0).renderTitleLabel(!0).titleLabelOffsetX(20).title(function(e){return e.value}).elasticX(!0).on("filtered",function(e,t){m_.showFilterUi("#panel_city",e),m_.dateCntCreate(),m_.on_chart_filtered(e,t)}),m_.chartCity.xAxis().ticks(0);let c=n.dimension(function(e){return d3.timeDay(new Date(e[0]))});m_.gpDate=c.group().reduceSum(function(e){return e[8]||1}),m_.dateCntCreate();let m=c.group().reduce(m_.group_reduce.append,m_.group_reduce.remove,m_.group_reduce.init);m_.chartDate.centerBar(!1).transitionDuration(750).dimension(c).group(m,"無症,退院",e=>e.value.lv_a).stack(m,"感染",e=>e.value.lv_b).stack(m,"肺炎,入院",e=>e.value.lv_c).stack(m,"酸投,重症",e=>e.value.lv_d).stack(m,"死亡",e=>e.value.lv_e).hidableStacks(!1).yAxisPadding("12%").renderLabel(!0).label(function(e,t){let a=moment(e.x).format("YYYYMMDD");return e.data.value.total===m_.dateCntMax||a===m_.dateCntTo?0===e.data.value.total?"":php_number_format(e.data.value.total):""}).ordinalColors(COL_CND.concat(COL_NAME).concat(COL_AGE)).gap(IS_SP?-4:-7).on("filtered",function(e,t){m_.on_chart_filtered(e,t)});for(var d=0;d<CHART_DATE_STACK2_N;d++)m_.date_stk_nm[d]="(選択"+(d+1)+")",m_.chartDate.stack(m,CHART_DATE_STACK_GRP[1][d],m_.dateStack2Accessor(m_.chartDate,d));for(d=0;d<13;d++)m_.chartDate.stack(m,CHART_DATE_STACK_GRP[2][d],m_.dateStack3Accessor(d));m_.dateStakShow(0),m_.pref_tbl_last_cnt=_.last(m_.chartDate.group().all()).value.nmcnt,m_.chartLine.dimension(c).colors("red").group(m_.gpDate,"週間移動平均").valueAccessor(function(e,t){0===t&&(m_.work=_.values(_.mapValues(m_.gpDate.all(),e=>e.value))),i=t-7+1;let a=m_.work.slice(i<0?0:i,i+7);return Math.round(_.sum(a)/7)});let p=1290;IS_SP&&(p=window.innerWidth+500),m_.composite.width(p).height(250).margins({top:0,right:0,bottom:20,left:35}).legend(dc.legend().x(IS_SP?p-350:60).y(0).legendText(e=>{let t=e.name.split(":");return 2===t.length?m_.date_stk_nm[t[1]]:e.name})).x(m_.domainDate?d3.scaleTime().domain(m_.domainDate):d3.scaleTime()).elasticX(!1).mouseZoomable(!1).xUnits(d3.timeDay).renderHorizontalGridLines(!0).brushOn(!1).elasticY(m_.config.cDateYm.is_elasticY).title(function(e){let t=isNaN(e.value),a="";for(;;){let t=moment(e.key).format("YYYY-MM-DD");if(t===YMD_ED_F[0][0]){a=YMD_ED_F[0][1];break}if(t===YMD_ED_F[1][0]){a=YMD_ED_F[1][1];break}if(t===YMD_ED_F[2][0]){a=YMD_ED_F[2][1];break}if(t===YMD_ED_F[3][0]){a=YMD_ED_F[3][1];break}if(t===YMD_ED_F[4][0]){a=YMD_ED_F[4][1];break}break}let n="object"==typeof e.key?moment(e.key).format("YYYY/M/D(ddd)"):e.key;if(!t)return n+"\n週間移動平均: "+php_number_format(e.value)+"名";let r=m_.chartName.filters();if(r.length>1&&r.length<=CHART_DATE_STACK2_N){let t="";for(f of r)t+=e.value.nmcnt[f]?f+": "+e.value.nmcnt[f]+"名\n":"";return n+"\n────────\n"+t+(r.length>1?"────────\n計: "+e.value.total+"名":"")+"\n"+a}if("age"===m_.sel_stack){let t="";for(var i=0;i<e.value.agcnt.length;i++){let a=_.round(100*e.value.agcnt[i]/e.value.total,1)+"%",n=CHART_DATE_STACK_GRP[2][i];t+=php_sprintf("%' -8s",n)+": "+php_sprintf("%' 3s",e.value.agcnt[i])+"名 ("+a+")\n"}return n+"\n──────────\n"+t+"──────────\n計: "+php_number_format(e.value.total)+"名\n"+a}return n+"\n────────\n"+(0===e.value.lv_a?"":"無症,退院: "+e.value.lv_a+"名\n")+(0===e.value.lv_b?"":"感染: "+e.value.lv_b+"名\n")+(0===e.value.lv_c?"":"肺炎,入院: "+e.value.lv_c+"名\n")+(0===e.value.lv_d?"":"酸投,重症: "+e.value.lv_d+"名\n")+(0===e.value.lv_e?"":"死亡: "+e.value.lv_e+"名\n")+"────────\n計: "+php_number_format(e.value.total)+"名\n"+a}).on("renderlet",function(e,t){}).on("pretransition",m_.on_chartDate_pretransition).addFilterHandler(m_.addFilterHandlerSingle).on("preRedraw",function(e){m_.chartDate.filterAll().filter([m_.composite.filters()])}).on("filtered",function(e,t){m_.showFilterUi("#panel_date",e,e=>moment(e).format("M/D(ddd)")),m_.on_chart_filtered(e,t)}).compose([m_.chartDate,m_.chartLine]),m_.composite.xAxis().ticks(7).tickFormat(function(e){return moment(e).format("M/Dddd")}),m_.composite.yAxis().ticks(5);let h=r.dimension(function(e){return d3.timeDay(new Date(e[0]))});m_.gpDate2=h.group().reduceSum(function(e){return e[2]});let u=h.group().reduce(function(e,t){let a=t[1],n=t[2],r=t[3];return e.all[r]+=n,e.pre[r][a]=(e.pre[r][a]||0)+n,e},function(e,t){let a=t[1],n=t[2],r=t[3];return e.all[r]-=n,e.pre[r][a]=(e.pre[r][a]||0)-n,e},function(e,t){return{all:[0,0,0],pre:[{},{},{}]}});function g(e,t){return function(a,n){let r=m_.chartName.filters();if(r.length>0){let n=r[t-1];return e.stack()[CHART_DATE2_STACK1_N+t-1].name=n,a.value.pre[m_.chartDate2Mode][n]||0}return e.stack()[CHART_DATE2_STACK1_N+t-1].name="(選択"+t+")",0}}m_.chartDate2.centerBar(!1).transitionDuration(750).dimension(h).elasticY(!0).group(u,"PCR",function(e){return 0==m_.chartName.filters().length&&0===m_.chartDate2Mode?e.value.all[0]:0}).stack(u,"死亡",function(e){return 0===m_.chartName.filters().length&&1===m_.chartDate2Mode?e.value.all[1]:0}).stack(u,"患者",function(e){return 0===m_.chartName.filters().length&&2===m_.chartDate2Mode?e.value.all[2]:0}).hidableStacks(!1).yAxisPadding("12%").renderLabel(!0).label(function(e,t){let a,n=moment(e.x).format("YYYYMMDD"),r=m_.chartName.filters();if(r.length){let t=_.filter(e.data.value.pre[m_.chartDate2Mode],(e,t)=>r.includes(t));a=_.sum(t)}else a=e.data.value.all[m_.chartDate2Mode];return 0===a?"":m_.dateCntMax2Ymd.includes(n)||n===m_.dateCntTo2?php_number_format(a):""}).ordinalColors(_.concat(DT_COL,_.concat(colorbrewer.Set1[3],colorbrewer.Set1[6]))).gap(IS_SP?-4:-7).on("filtered",function(e,t){m_.on_chart_filtered(e,t)});for(d=1;d<6;d++)m_.chartDate2.stack(u,"(選択"+d+")",g(m_.chartDate2,d));m_.chartLine2.dimension(h).colors("red").group(m_.gpDate2,"週間移動平均").valueAccessor(function(e,t){if(0===t){let e=m_.chartName.filters();m_.work=[],m_.dateCntTo2="00000000",m_.dateCntMax2Ymd=[],e.length?m_.chartDate2.group().all().forEach(t=>{let a=_.filter(t.value.pre[m_.chartDate2Mode],(t,a)=>e.includes(a)),n=_.sum(a);m_.work.push(n);let r=moment(t.key).format("YYYYMMDD");n>0&&r>m_.dateCntTo2&&(m_.dateCntTo2=r),n===m_.dateCntMax2&&m_.dateCntMax2Ymd.push(r)}):m_.chartDate2.group().all().forEach(e=>{let t=e.value.all[m_.chartDate2Mode];m_.work.push(t);let a=moment(e.key).format("YYYYMMDD");t>0&&a>m_.dateCntTo2&&(m_.dateCntTo2=a)}),2===m_.chartDate2Mode?$("#cnt_all2").text(php_number_format(_.last(m_.work))):$("#cnt_all2").text(php_number_format(_.sum(m_.work))),m_.dateCntMax2=_.max(m_.work)}i=t-7+1;let a=m_.work.slice(i<0?0:i,i+7);return Math.round(_.sum(a)/7)}),m_.composite2.width(p).height(160).margins({top:0,right:0,bottom:20,left:30}).legend(dc.legend().x(IS_SP?p-350:60).y(0)).x(m_.domainDate?d3.scaleTime().domain(m_.domainDate):d3.scaleTime()).elasticX(!1).mouseZoomable(!1).xUnits(d3.timeDay).renderHorizontalGridLines(!0).brushOn(!1).elasticY(m_.config.cDateYm.is_elasticY).title(function(e){let t=isNaN(e.value),a="";for(;;){let t=moment(e.key).format("YYYY-MM-DD");if(t===YMD_ED_F[0][0]){a=YMD_ED_F[0][1];break}if(t===YMD_ED_F[1][0]){a=YMD_ED_F[1][1];break}if(t===YMD_ED_F[2][0]){a=YMD_ED_F[2][1];break}if(t===YMD_ED_F[3][0]){a=YMD_ED_F[3][1];break}if(t===YMD_ED_F[4][0]){a=YMD_ED_F[4][1];break}break}let n="object"==typeof e.key?moment(e.key).format("YYYY/M/D(ddd)"):e.key;if(!t)return n+"\n週間移動平均: "+php_number_format(e.value)+"名";let r=m_.chartName.filters();if(r.length>0){let t="",i=e.value.pre[m_.chartDate2Mode],o=0;for(f of r)t+=i[f]?f+": "+php_number_format(i[f])+"名\n":"",o+=i[f];return n+"\n────────\n"+t+(r.length>1?"────────\n計: "+php_number_format(o)+"名":"")+"\n"+a}return n+"\n────────\n全国 計: "+(0===e.value.all[m_.chartDate2Mode]?"":php_number_format(e.value.all[m_.chartDate2Mode])+"名\n")+a}).on("renderlet",function(e,t){}).on("pretransition",m_.on_chartDate_pretransition).addFilterHandler(m_.addFilterHandlerSingle).on("preRedraw",function(e){m_.chartDateLegendUpdate2(),m_.chartDate2.filterAll().filter([m_.composite2.filters()])}).on("filtered",function(e,t){m_.showFilterUi("#panel_date",e,e=>moment(e).format("M/D(ddd)")),m_.on_chart_filtered(e,t)}).compose([m_.chartDate2,m_.chartLine2]),m_.composite2.xAxis().ticks(7).tickFormat(function(e){return moment(e).format("M/Dddd")}),m_.composite2.yAxis().ticks(5).tickFormat(d3.format("~s"));let b=n.dimension(function(e){return e[1]}),k=b.group().reduceSum(function(e){return 1});m_.chartSex.width(148).height(158).cx(parseInt(74)).externalRadiusPadding(18).innerRadius(15).slicesCap(3).dimension(b).group(k).addFilterHandler(m_.addFilterHandlerSingle).filterPrinter(function(e){return e.map(function(e){return SEX_LABEL[e]}).join(", ")}).on("filtered",function(e,t){m_.dateCntCreate(),m_.on_chart_filtered(e,t)}).ordering(function(e){return-e.value}).colors(function(e){return COL_SEX[e]}).renderLabel(!0).label(function(e){return"empty"===e.key?"":SEX_LABEL[e.key]+":"+php_number_format(e.value)}).title(function(e){return"empty"===e.key?"":SEX_LABEL[e.key]+": "+php_number_format(e.value)+"名"});let v=n.dimension(function(e){return new Date(e[0]).getDay()}),w=v.group().reduce(m_.group_reduce_light.append,m_.group_reduce_light.remove,m_.group_reduce_light.init).order(function(e){return e.total}),D=350;IS_SP&&(D=window.innerWidth-$("#chart_sex").width()-40,$("#chart_week").css("width",D+5+"px"));m_.chartWeek.width(D).height(148).margins({top:0,right:0,bottom:20,left:40}).gap(6).transitionDuration(750).dimension(v).group(w,"無症,退院",e=>e.value.lv_a).stack(w,"感染",e=>e.value.lv_b).stack(w,"肺炎,入院",e=>e.value.lv_c).stack(w,"酸投,重症",e=>e.value.lv_d).stack(w,"死亡",e=>e.value.lv_e).xUnits(dc.units.ordinal).elasticX(!0).filterPrinter(function(e){return e.map(function(e){return WEEK_LABEL[e]}).join(", ")}).x(d3.scaleOrdinal()).y(d3.scaleLinear().domain([0,1e5])).elasticY(!0).yAxisPadding("25%").on("filtered",function(e,t){m_.dateCntCreate(),m_.on_chart_filtered(e,t)}).renderHorizontalGridLines(!0).ordinalColors(COL_CND).renderLabel(!0).label(function(e){return e.data.value.total}).title(function(e){return WEEK_LABEL[e.key]+"\n────────\n"+(0===e.value.lv_a?"":"無症,退院: "+e.value.lv_a+"名\n")+(0===e.value.lv_b?"":"感染: "+e.value.lv_b+"名\n")+(0===e.value.lv_c?"":"肺炎,入院: "+e.value.lv_c+"名\n")+(0===e.value.lv_d?"":"酸投,重症: "+e.value.lv_d+"名\n")+(0===e.value.lv_e?"":"死亡: "+e.value.lv_e+"名\n")+"────────\n計: "+e.value.total+"名"}),m_.chartWeek.xAxis().tickFormat(e=>WEEK_LABEL[e]),m_.chartWeek.yAxis().ticks(4);let C=n.dimension(function(e){return e[2]}),y=C.group().reduce(m_.group_reduce_light.append,m_.group_reduce_light.remove,m_.group_reduce_light.init).order(function(e){return e.total}),x=504;IS_SP&&(x=window.innerWidth-20),m_.chartAge.width(x).height(158).transitionDuration(750).margins({top:0,right:0,bottom:20,left:40}).dimension(C).on("filtered",function(e,t){m_.dateCntCreate(),0===m_.chartAge.filters().length?$("#stack_type_con").prop("checked",!0).trigger("change"):$("#stack_type_age").prop("checked",!0).trigger("change"),m_.on_chart_filtered(e,t)}).group(y,"無症,退院",e=>e.value.lv_a).addFilterHandler(m_.addFilterHandlerSingleR).stack(y,"感染",e=>e.value.lv_b).stack(y,"肺炎,入院",e=>e.value.lv_c).stack(y,"酸投,重症",e=>e.value.lv_d).stack(y,"死亡",e=>e.value.lv_e).renderLabel(!0).legend(dc.legend().x(60).y(0)).title(function(e){return m_.ageTickFormat(e.key)+"\n────────\n"+(0===e.value.lv_a?"":"無症,退院: "+e.value.lv_a+"名\n")+(0===e.value.lv_b?"":"感染: "+e.value.lv_b+"名\n")+(0===e.value.lv_c?"":"肺炎,入院: "+e.value.lv_c+"名\n")+(0===e.value.lv_d?"":"酸投,重症: "+e.value.lv_d+"名\n")+(0===e.value.lv_e?"":"死亡: "+e.value.lv_e+"名\n")+"────────\n計: "+e.value.total+"名"}).brushOn(!1).gap(6).ordinalColors(COL_CND).xUnits(dc.units.ordinal).x(d3.scaleOrdinal()).y(d3.scaleLinear().domain([0,1e5])).elasticY(!0).yAxisPadding("20%").renderHorizontalGridLines(!0).addFilterHandler(m_.addFilterHandlerSingleR),m_.chartAge.xAxis().tickFormat(m_.ageTickFormat),m_.chartAge.yAxis().ticks(5);let S=n.dimension(function(e){return e[3]}),A=S.group().reduceSum(function(e){return""===e[3]||"調査中"===e[3]?0:e[8]||1}),j=620;IS_SP&&(j=window.innerWidth+200),m_.chartCond.width(j).height(158).gap(6).transitionDuration(750).dimension(S).group(m_.groupRemoveEmpty(A)).addFilterHandler(m_.addFilterHandlerSingleR).margins({top:0,right:0,bottom:70,left:45}).xUnits(dc.units.ordinal).elasticX(!0).x(d3.scaleOrdinal()).y(d3.scaleLinear().domain([0,1e5])).elasticY(!0).yAxisPadding("18%").on("postRedraw",function(e){}).on("renderlet",function(e,t){_.delay(()=>{$("#chart_cond rect.selected title").each((e,t)=>{let a=t.textContent.split(":")[0].trim();$("#chart_cond g.axis.x text").filter(function(){return $(this).text()===a}).addClass("sel")})},10)}).on("filtered",function(e,t){m_.showFilterUi("#panel_cond",e),m_.dateCntCreate(),m_.on_chart_filtered(e,t)}).ordering(function(e){return-e.value}).renderHorizontalGridLines(!0).renderLabel(!0).title(function(e){return e.key+" : "+e.value+"名"}),m_.data_type?m_.chartCond.colorAccessor(function(e){let t,a=-1!==e.key.indexOf("無症状"),n=-1!==e.key.indexOf("退院"),r=-1!==e.key.indexOf("入院"),i=-1!==e.key.indexOf("肺炎"),o=-1!==e.key.indexOf("中等"),l=-1!==e.key.indexOf("酸投"),_=-1!==e.key.indexOf("重症"),c=-1!==e.key.indexOf("死亡");for(;;){if(c){t=4;break}if(l||_){t=3;break}if(i||r||o){t=2;break}if(n||a){t=0;break}t=1;break}return t}).colors(function(e){return COL_CND[e]}):m_.chartCond.colorAccessor(function(e,t){return t}).colors(function(e){return colorbrewer.Set3[9][e%9]}),m_.chartCond.xAxis().tickFormat(e=>""===e?"調査中":e),m_.chartCond.yAxis().ticks(4),m_.dimJob=n.dimension(function(e){return e[6]}),m_.gpJob=m_.dimJob.group().reduceSum(function(e){return""===e[6]?0:e[8]||1}),m_.gpJob=m_.groupRemoveEmpty(m_.gpJob);let T,E=_.uniq(_.map(m_.data,7));m_.is_job_cate=!(1===E.length&&0===E[0]),m_.is_job_cate?(m_.dimJobCat=n.dimension(function(e){return m_.jobcates[e[7]]}),m_.gpJobCat=m_.dimJobCat.group().reduceSum(function(e){return 0===e[7]?0:e[8]||1}),m_.gpJobCat=m_.groupRemoveEmpty(m_.gpJobCat),T=m_.gpJobCat.all().length*m_.config.cJob.barWidth):T=m_.gpJob.all().length*m_.config.cJob.barWidth,m_.chartJob.width(T).height(200).gap(4).transitionDuration(m_.config.cJob.TD).dimension(m_.is_job_cate?m_.dimJobCat:m_.dimJob).group(m_.is_job_cate?m_.gpJobCat:m_.gpJob).margins({top:0,right:0,bottom:100,left:40}).xUnits(dc.units.ordinal).elasticX(!0).x(d3.scaleOrdinal()).y(d3.scaleLinear().domain([0,1e5])).elasticY(!0).yAxisPadding("15%").controlsUseVisibility(!1).on("postRedraw",function(e){m_.on_chart_postRedraw(e)}).on("renderlet",function(e){_.delay(()=>{$("#chart_job rect.selected title").each((e,t)=>{let a=t.textContent.split(":")[0].trim();$("#chart_job g.axis.x text").filter(function(){return $(this).text()===a}).addClass("sel")})},10)}).on("pretransition",function(e){e.transitionDuration(0),e.width((e.xUnitCount()+1)*m_.config.cJob.barWidth)}).on("filtered",function(e,t){m_.showFilterUi("#panel_job",e),m_.dateCntCreate(),m_.on_chart_filtered(e,t)}).ordering(function(e){return-e.value}).renderHorizontalGridLines(!0).renderLabel(!0).colorAccessor(function(e,t){return t}).colors(function(e){return colorbrewer.Set3[9][e%9]}).title(function(e){return e.key+": "+e.value+"名"}).addFilterHandler(m_.addFilterHandlerSingle),m_.chartJob.xAxis().tickFormat(e=>""===e?"不明":e),m_.chartJob.yAxis().ticks(3),IS_SP?$("#btn_search").attr({placeholder:"フィルタ",title:"都道府県や市区町村、職業、状態、日付等の入力でグラフのフィルタリングが行えます。"}).on("focus",function(e){e.preventDefault(),$(this).css("width","10em")}).on("blur",function(e){e.preventDefault(),$(this).css("width","6em")}):$("#btn_search").attr({placeholder:"都道府県や市区町村、職業、状態、日付でフィルタ",title:"都道府県や市区町村、職業、状態、日付等の入力でグラフのフィルタリングが行えます。\nショートカットキー\n　フォーカス : Ctrl+Shift+F\n　全クリア : Ctrl+Shift+L"}),m_.parseURLParams(),m_.chartAllFilterByKW_render||m_.renderAllChart(),$("#btn_search").on("focus",function(e){_.delay(()=>$(this).select(),7)}),$("#div_date").scrollLeft(800),m_.data_type?($("#chart_map_title").show(),m_.chartCity.addFilterHandler(m_.addFilterHandlerSingleR),m_.chartCond.addFilterHandler(m_.addFilterHandlerSingleR),m_.get.tab&&m_.tab.tabs("option","activate").call(null,null,null,"tabs_"+m_.get.tab)):(m_.sel_tab="tabs_c",$("#div_div_date2").hide(),$("#ch_pnl_city").prop("checked",!0).trigger("ch_pnl_update"),$("#ch_pnl_week").prop("checked",!0).trigger("ch_pnl_update"),$("#chart_map_title").hide(),m_.chartCity.addFilterHandler(m_.addFilterHandlerSingle),m_.chartCond.addFilterHandler(m_.addFilterHandlerSingle)),$("#panel_name .chart-title").text(m_.data_hdr[4]),$("#panel_city .chart-title").text(m_.data_hdr[5]),$("#panel_date .chart-title").html(m_.data_type?'<i class="fa fa-procedures"></i>感染者数':m_.data_hdr[0]),$("#panel_cond .chart-title").text(m_.data_hdr[3]),$("#panel_job .chart-title").text(m_.data_hdr[6]),m_.data_type?$("#stack_type_con").prop("checked",!0).trigger("change"):$("#stack_type_age").prop("checked",!0).trigger("change"),IS_SP||$("#btn_search").focus()},initTabs=()=>{$("#chart_map_title").show(),m_.tab=$("#chart_map").tabs({active:m_.get.tab?{c:1,p:2,pc:3,d:4,b:5}[m_.get.tab]:1,activate:function(e,t,a){switch(m_.sel_tab=a||t.newPanel.attr("id"),m_.sel_tab){case"tabs_c":$("#ch_pnl_name,#ch_pnl_date"+(IS_SP?"":",#ch_pnl_sex")+",#ch_pnl_week,#ch_pnl_age,#ch_pnl_cond,#ch_pnl_job").prop("checked",!0).trigger("ch_pnl_update","is_setting_load"),m_.chartName.group(m_.gpName).render(),$("#panel_name .chart-title").text("都道府県"),$("#div_div_date2 .chart-title2").text(""),$("#div_div_date2").hide(),$("#world-map").hide(),$("#japan-map").show(),drawJapanMap();let e=m_.getFilterTxt();e[1]="",fth=e.join(" ").trim(),$(".hdr_flt_map").text(""===fth?"":fth+"の状況"),$("#legend_n").show(),$("#legend_p").hide();break;default:if("tabs_b"===m_.sel_tab)$("#ch_pnl_city,#ch_pnl_date,#ch_pnl_sex,#ch_pnl_week,#ch_pnl_age,#ch_pnl_cond,#ch_pnl_job").prop("checked",!1).trigger("ch_pnl_update","cmd_none"),$("#ch_pnl_name").prop("checked",!0).trigger("ch_pnl_update","cmd_none"),$("#div_div_date2").hide(),gpName2=m_.dimName2.group().reduce((e,t)=>m_.pref_tbl_last_m1[t[1]].bed,(e,t)=>m_.pref_tbl_last_m1[t[1]].bed,(e,t)=>0),m_.chartName.group(gpName2).render();else{$("#ch_pnl_city,            #ch_pnl_sex,#ch_pnl_week,#ch_pnl_age,#ch_pnl_cond,#ch_pnl_job").prop("checked",!1).trigger("ch_pnl_update","cmd_none"),$("#ch_pnl_name").prop("checked",!0).trigger("ch_pnl_update","cmd_none"),$("#ch_pnl_date").prop("checked",!0).trigger("ch_pnl_update","cmd_none");let e,t=$("#div_div_date2 .chart-title");switch($("#div_div_date2 .chart-title2").text(""),m_.sel_tab){case"tabs_p":m_.chartDate2Mode=2,t.html('<i class="fa fa-procedures"></i>患者数(累計)'),$("#div_div_date2 .chart-title2").text("※入院治療等を要する患者数。(感染者数から無症状、退院、死亡者数を引いた値)"),e=m_.dimName2.group().reduce((e,t)=>t[2],(e,t)=>t[2],(e,t)=>0),$("#panel_name .chart-title").text("都道府県(患者)");break;case"tabs_pc":m_.chartDate2Mode=0,e=m_.dimName2.group().reduceSum(function(e){return 0===e[3]?e[2]:0}),t.html('<i class="fa fa-vials"></i>PCR検査人数'),$("#panel_name .chart-title").text("都道府県(PCR)");break;case"tabs_d":m_.chartDate2Mode=1,e=m_.dimName2.group().reduceSum(function(e){return 1===e[3]?e[2]:0}),t.html("死亡者数"),$("#panel_name .chart-title").text("都道府県(死亡)")}$("#div_div_date2").show(),$("#div_date2").scrollLeft($("#div_date").scrollLeft()),m_.chartName.group(e);let a=m_.chartName.filters(),n=m_.chartCity.filters();if(0===a.length&&n.length){let e=[];$("#chart_name g.row text").each(function(t,a){let n=this.textContent.replace(/[　\s]+/,",").split(",");0!=n[1]&&e.push(n[0])}),m_.chartName.filter([e])}m_.chartName.render(),m_.composite2.render()}$("#world-map").hide(),$("#japan-map").show(),drawJapanMap(),$(".hdr_flt_map").text("～"+moment(m_.chartDate.xAxisMax()).format("MM/DD(ddd)")+"の状況"),"tabs_pc"===m_.sel_tab?($("#legend_n").hide(),$("#legend_p").show()):($("#legend_n").show(),$("#legend_p").hide());break;case"tabs_w":location.href="covid19-world.html"}IS_SP||$("#btn_search").focus().select()},create:function(e,t){$("#chart_map .ui-widget-header").append($('<span class="ui-icon ui-icon-circle-close sp_icon btn_close" ch_id="ch_pnl_map" style="float:right;top: 8px;"></span>'))}})},initAutoComplete=()=>{$.widget("ui.autocomplete_ex",$.ui.autocomplete,{options:{itemMax:16,minLength:1,delay:500,position:{my:"left top",at:"left bottom+12",collision:"none"},_usr:{AC_SPLIT_WD:/\s+/}},_create:function(){this._super(),this.widget().menu("option","items","> :not(.ac_ex-cate)")},_init:function(){var e=this;e.source=e.options.source=function(t,a){let n,r=this.option("itemMax");(n=e.options.user_opt.multiple?t.term.split(e.options._usr.AC_SPLIT_WD).pop():t.term).length&&a(_.filter(e.options.user_opt.data,e=>{let t=n[0].match(/[a-z]/i)?1:0,a="";switch(e[0]){case"職業":a=JOB_HIRA[e[1]]||"";break;case"状態":a=LV_HIRA[e[1]]||"";break;default:a=PREF_HIRA[""===e[0]?e[1]:e[0]]||""}return t?void 0!==PREF_EN[e[0]]&&-1!==PREF_EN[e[0]].indexOf(n)||-1!==e[2].indexOf(n):-1!==(e[0]+a).indexOf(n)||-1!==e[1].indexOf(n)}).slice(0,r))},e.options.focus=function(t,a){if(e.options.user_opt.multiple){let t=this.value.trim().split(e.options._usr.AC_SPLIT_WD);t.pop(),t.push(a.item[1]),t.push(""),this.value=t.join(" ")}else this.value=a.item[1];return!1},e.options.select=function(t,a){return t.preventDefault(),e.options.user_opt.select&&(ret=e.options.user_opt.select(t,a)),ret}},_renderMenu:function(e,t){let a=this,n="";$.each(t,function(t,r){let i;if(r[0]!=n){let t="";switch(r[0]){case"職業":t='<i class="fa fa-id-card-o" style="padding:4px"></i>';break;case"状態":t='<i class="fa fa-medkit" style="padding:4px"></i>';break;default:t='<img width="40" height="40" src="'+("img/japan/"+PREF_EN[r[0]]+".gif")+'" onerror="this.src=\'/'+IMG_NO+"'\" />"}e.append("<li class='ac_ex-cate'>"+t+r[0]+"</li>"),n=r[0]}i=a._renderItemData(e,r)})},_renderItem:function(e,t){let a=this.element.val().trim();this.options.user_opt.multiple&&(a=_.last(a.split(this.options._usr.AC_SPLIT_WD)));let n=""===t[0],r=t[1],i='<span class="ac_ex-kwd">'+a.toUpperCase()+"</span>";if(r=r.replace(new RegExp(a,"gi"),i),n){let e="img/japan/"+PREF_EN[t[1]]+".gif";icon='<img width="40" height="40" src="'+e+'" onerror="this.src=\'/'+IMG_NO+"'\" />",r=icon+r}return $("<li class='ac_ex-item'>").append($("<div>").html(r+"("+t[3]+")")).appendTo(e)}})};var map;const drawJapanMap=()=>{$("#japan-map").empty();let e="tabs_pc"===m_.sel_tab?{"0.4%以上":"#8c0a00","0.2%以上":"#ea5432","0.1%以上":"#ff781d","0.05%以上":"#ff9d57","0.01%以上":"#ffceab","0%以上":"#ffffe0","0%":"#dadada","選択中":"#ffffff"}:{"1000人以上":"#8c0a00","500人以上":"#ea5432","100人以上":"#ff781d","50人以上":"#ff9d57","10人以上":"#ffceab","1人以上":"#f5deb3","0人":"#dadada","選択中":"#ffffff"},t=m_.getPrefCntTbl(),a={};_.keys(m_.pref_tbl_last_m1).forEach(function(e){let n,r=t[e];for(;;){if(r>999){n=MAP_COL_TBL[0][1];break}if(r>499){n=MAP_COL_TBL[1][1];break}if(r>99){n=MAP_COL_TBL[2][1];break}if(r>49){n=MAP_COL_TBL[3][1];break}if(r>9){n=MAP_COL_TBL[4][1];break}if(r>0){n=MAP_COL_TBL[5][1];break}n=MAP_COL_TBL[6][1];break}a[_.capitalize(PREF_EN[e])]=n}),(map=new jvm.Map({container:$("#japan-map"),map:"jp_merc",panOnDrag:!IS_SP,focusOn:{x:.45,y:.48,scale:IS_SP?1:1.7,animate:!1},backgroundColor:null,zoomOnScroll:!0,zoomOnScrollSpeed:1,zoomStep:1.4,regionsSelectable:!0,hoverOpacity:.7,regionStyle:{selected:{stroke:"#1a75ff","stroke-width":3}},series:{regions:[{attribute:"fill"},{scale:e,attribute:"fill",legend:{vertical:!0}}]},onRegionTipShow:!IS_SP&&((e,t,a)=>{let n=map.mapData.paths[a].name,r=m_.getChartnameTitle(n,"<BR>");t.html(r)}),onRegionSelected:()=>{if(m_.is_filter_region_sel)return;let e=map.getSelectedRegions().map(e=>map.mapData.paths[e].name);m_.chartNameFilters(e),m_.is_drawJapanMap=0,m_.chartName.filters().length&&$("#ui-datepicker-div").is(":visible")&&(m_.datePick.datepicker("hide"),m_.datePick.datepicker("show"))}})).series.regions[0].setValues(a),$(".jvectormap-legend-tick-sample:last").css({border:"3px solid #1a75ff"}),m_.mapSetSelectedRegions()};$(document).ready(function(){if(initTabs(),$(".btn_clear_all").on("click",function(e){e.preventDefault(),$("#btn_search").val(""),$(".filter_txt").val(""),$(".btn_brush").trigger("my_update",1),m_.dimJob.filterAll(),dc.filterAll("chartGroup"),m_.is_drawJapanMap=1,m_.renderAllChart(),document.querySelector("#div_name").scrollTop=0,document.querySelector("#div_city").scrollTop=0,$("#ui-datepicker-div").is(":visible")&&m_.datePick.datepicker("show"),IS_SP||$("#btn_search").focus()}),$("#btn_search").on("keyup btn_search_update",function(e){if(e.preventDefault(),"btn_search_update"===e.type||e.keyCode===$.ui.keyCode.ENTER){let e=this.value.trim();""!==e&&(m_.chartAllFilterByKW_render=m_.chartAllFilterByKW(e),_.delay(()=>$(".ui-menu").hide(),200))}}),m_.datePick=$("#btn_date").val(moment().format("YYYY/MM/DD")).datepicker({showOn:"button",buttonText:'<i class="ui-icon ui-icon-calendar-day ui-icon-big"></i>',showOtherMonths:!0,numberOfMonths:IS_SP?[1,3]:[2,4],showCurrentAtPos:IS_SP?2:7,stepMonths:IS_SP?3:4,position:{of:$(window),my:"center",at:"center",collision:"fit fit"},onSelect:function(e,t){$("#btn_search").val(e).trigger("btn_search_update")},beforeShowDay:function(e){let t=[],a=e.getFullYear()+printf02d(e.getMonth()+1)+printf02d(e.getDate());t[0]=1,t[1]=$.datepicker.regional.ja&&void 0!==$.datepicker.regional.ja.holidays[a]?"holiday":"";let n=m_.dateCnt[a]||0;for(;;){if(n>999){t[1]+=" c1000";break}if(n>499){t[1]+=" c500";break}if(n>99){t[1]+=" c100";break}if(n>49){t[1]+=" c50";break}if(n>9){t[1]+=" c10";break}if(n>0){t[1]+=" c1";break}break}return 0!==n&&(t[2]=m_.dateCnt[a]+"名"),t},beforeShow:function(e,t){m_.dateCntCreate();var a=t.dpDiv;setTimeout(function(){a.position(IS_SP?{my:"left top",at:"left bottom",collision:"fit none",of:$("#btn_search")}:{my:"left bottom",at:"right+280 bottom",collision:"fit fit",of:e})},IS_SP?100:5)}}),$(".ui-datepicker-trigger").addClass("ui-button ui-corner-all ui-widget"),$("#reset_btn_date").on("click",function(e){e.preventDefault(),m_.composite.filterAll(),m_.chartDate.filterAll(),m_.renderAllChart()}),$(".btn_close").button().on("click",function(e){e.preventDefault(),$("#"+$(this).attr("ch_id")).trigger("click")}),$(".btn_close2").button().on("click",function(e){e.preventDefault(),$(this).closest("tr").hide()}),$(".btn_brush").button().on("click",function(e){e.preventDefault();let t=m_.composite.brushOn();if(t)$("#reset_btn_date").trigger("click"),$("#panel_date .filter_txt_diff").text("");else{let e=m_.composite.filters();if(e.length){let t=[[[e[0],moment(_.last(e)).add(1,"days").toDate()]]];m_.composite.filter(t),m_.chartDate.filter(t)}}$(this).trigger("my_update",t)}).on("my_update",function(e,t){$(this).removeClass("btn_off btn_on").addClass(t?"btn_off":"btn_on"),m_.composite.brushOn(!t).render()}),$('[name="stack_type"]').on("change",function(e){switch(m_.sel_stack=$(this).val(),m_.sel_stack){case"con":m_.dateStakShow(0);break;case"pre":m_.dateStakShow(1);break;case"age":m_.dateStakShow(2)}m_.composite.render()}),IS_SP||$(".drag").draggable({snap:!0,snapTolerance:IS_SP?80:20,cursor:"move",handle:".chart-title"}),$("#btn_download_csv").button().on("click",function(e){e.preventDefault();let t=m_.ndx.allFiltered(),a=m_.data_hdr.join(",")+"\n",n=m_.data_hdr.findIndex(e=>"年齢"===e),r=m_.data_hdr.findIndex(e=>"性別"===e);for(var i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(a+=0===o?"":",";;){if(o===n){a+=-1===t[i][o]?"不明":t[i][1];break}if(o===r){a+=SEX_LABEL[t[i][o]];break}a+=t[i][o];break}8===t[i].length&&(a+=",1"),a+="\n"}let l=$(".hdr_flt").text().replace("の状況","");const _=new Uint8Array([239,187,191]),c=(m_.data_type?"covid19":"data")+" - ["+l+"].csv",s=new Blob([_,a],{type:"text/csv"});if(window.navigator.msSaveBlob)window.navigator.msSaveBlob(s,c);else{const e=(window.URL||window.webkitURL).createObjectURL(s),t=document.createElement("a");t.href=e,t.download=c,t.click(),(window.URL||window.webkitURL).revokeObjectURL(e)}}),IS_SP){let e="#div_date",t="#div_date2";$(e).on("scroll",function(a){let n=$(e);$(t).scrollLeft(n.scrollLeft())}),$(t).on("scroll",function(a){let n=$(t);$(e).scrollLeft(n.scrollLeft())})}$(".filter_txt").on("focus",function(e){e.preventDefault(),$(this).select()})}),$(document).ready(function(){$("#btn_ana").on("click",function(e){e.preventDefault(),$("#ana_diff_ls").hide().fadeIn()}),$(".wopen").button().on("click",function(e){e.preventDefault();let t=$(this),a=parseInt(screen.width/2)-20;if(t.find("span").hasClass("ui-icon-arrow-2-e-w")){let e=t.closest("td"),n=e.prev().find("a"),r=e.next().find("a"),i=window.open(n.attr("href"),1,"top=50,left=0,height="+(screen.height-200)+",width="+a),o=window.open(r.attr("href"),2,"top=50,left="+(a+20)+",height="+(screen.height-200)+",width="+a);$(i).on("scroll",function(e){let t=$(i);$(o).scrollTop(t.scrollTop()).scrollLeft(t.scrollLeft())}),$(o).on("scroll",function(e){let t=$(o);$(i).scrollTop(t.scrollTop()).scrollLeft(t.scrollLeft())})}else if(t.find("span").hasClass("ui-icon-arrow-2-n-s")){let e=t.closest("td").index(),n=t.closest("tr"),r=n.prev().find("td").eq(e).find("a"),i=n.next().find("td").eq(e).find("a"),o=window.open(r.attr("href"),1,"top=50,left=0,height="+(screen.height-200)+",width="+a),l=window.open(i.attr("href"),2,"top=50,left="+(a+20)+",height="+(screen.height-200)+",width="+a);$(o).on("scroll",function(e){let t=$(o);$(l).scrollTop(t.scrollTop()).scrollLeft(t.scrollLeft())}),$(l).on("scroll",function(e){let t=$(l);$(o).scrollTop(t.scrollTop()).scrollLeft(t.scrollLeft())})}else{let e=t.closest("td").index();window.open(t.attr("href"),0===e?1:2,"left="+(0===e?0:a+20)+",top=50,height="+(screen.height-200)+",width="+a)}})}),$(document).ready(function(){m_.settingsLoad();const e=[{ch:"#ch_pnl_name",div:"#panel_name",pc:1,sp:1},{ch:"#ch_pnl_city",div:"#panel_city",pc:1,sp:1},{ch:"#ch_pnl_date",div:"#panel_date",pc:1,sp:1},{ch:"#ch_pnl_sex",div:"#chart_sex",pc:1,sp:0},{ch:"#ch_pnl_week",div:"#chart_week",pc:0,sp:0},{ch:"#ch_pnl_age",div:"#chart_age",pc:1,sp:1},{ch:"#ch_pnl_cond",div:"#panel_cond",pc:1,sp:1},{ch:"#ch_pnl_job",div:"#panel_job",pc:1,sp:1},{ch:"#ch_pnl_ana",div:"#panel_ana",pc:0,sp:0},{ch:"#ch_pnl_map",div:"#chart_map",pc:1,sp:1},{ch:"#ch_pnl_detail",div:"#panel_detail",pc:1,sp:1}];function t(e){let t=$(e.ch),a=e.ch.replace("#",""),n=e.div,r=m_.settings[a];if(void 0!==m_.get.light)switch(a){case"ch_pnl_week":r=1;break;case"ch_pnl_ana":r=0,$('[for="ch_pnl_ana"]').hide()}t.prop("checked",!!r).on("ch_pnl_update",function(e,t="is_setting_save"){let r=$(n);"is_setting_load"===t&&$(this).prop("checked",m_.settings[a]);let i=$(this).is(":checked");i?r.show():r.hide(),"is_setting_save"===t&&(m_.settings[a]=i?1:0,localStorage.setItem(m_.settings_name,JSON.stringify(m_.settings)))}).on("change",function(){$(this).trigger("ch_pnl_update")}).trigger("ch_pnl_update","cmd_none")}if(!m_.settings){m_.settings={};for(var a=0;a<e.length;a++){let t=e[a],n=t.ch.replace("#","");m_.settings[n]=IS_SP?t.sp:t.pc}}for(a=0;a<e.length;a++)t(e[a])}),$(document).keyup(function(e){switch(e.keyCode){case 76:e.ctrlKey&&e.shiftKey&&(document.activeElement&&"tbl_flt"===document.activeElement.id?$(id).val("").trigger("change"):$(".btn_clear_all").trigger("click"));break;case 70:if(e.ctrlKey&&e.shiftKey){let e=document.activeElement&&"tbl_flt"===document.activeElement.id?"#tbl_flt":"#btn_search";$(e).focus().select()}}}),$("body").tooltip({items:"[tt_title],.tt_img",show:{effect:"show",delay:500},hide:0,content:function(){let e=$(this);return e.is(".tt_img")?'<img src="'+e.attr("src")+'">':e.attr("tt_title")}});const PREF_DATA=[["https://www.mhlw.go.jp/stf/seisakunitsuite/bunya/0000121431_00086.html","ホーム > 政策について > 分野別の政策一覧 > 健康・医療 > 健康 > 感染症情報 > 新型コロナウイルス感染症について > 新型コロナウイルス感染症に関する報道発表資 - 厚生労働省"],["https://signate.jp/covid-19-challenge","企業（SIGNATE COVID-19 Dataset）",""],[],["https://www.harp.lg.jp/opendata/dataset/1369.html","HOME›データカタログ›新型コロナウイルス感染症に関するデータ【北海道】 - 北海道"],["https://opendata.pref.aomori.lg.jp/dataset/1531.html",""],["https://www.pref.iwate.jp/kurashikankyou/iryou/covid19/index.html",""],["https://www.pref.miyagi.jp/site/covid-19/02.html",""],["https://www.pref.akita.lg.jp/pages/archive/47957",""],["https://www.pref.yamagata.jp/ou/kenkofukushi/090001/20130425/shingata_corona.html","ホーム > 組織で探す > 健康福祉部 > 健康福祉企画課（薬務・感染症対策室） > 感染症対策担当 > 新型コロナウイルス感染症（COVID-19）について"],["https://www.pref.fukushima.lg.jp/sec/21045c/covid19-opendata.html",""],[],["https://www.pref.ibaraki.jp/hokenfukushi/yobo/kiki/yobo/kansen/idwr/information/other/documents/20200130-corona.html",""],["http://www.pref.tochigi.lg.jp/e04/welfare/hoken-eisei/kansen/hp/coronakensahasseijyoukyou.html",""],["https://www.pref.gunma.jp/07/z87g_00016.html","トップページ 県政情報 広聴・広報 (新型コロナウイルス感染症) 新型コロナウイルス感染症患者の発生状況 - 群馬県"],["https://www.pref.saitama.lg.jp/a0701/covid19/jokyo.html","総合トップ > 健康・福祉 > 医療 > 感染症対策 > 感染確認状況や関連情報 > 新型コロナウイルス感染症の県内の発生状況 - 埼玉県"],["https://covid19.civictech.chiba.jp/","新型コロナウイルス感染症対策サイト - 千葉県"],["https://stopcovid19.metro.tokyo.lg.jp/","新型コロナウイルス感染症対策サイト - 東京都"],["http://www.pref.kanagawa.jp/docs/t3u/dst/s0060925.html","ホーム > 健康・福祉・子育て > 医療 > 感染症・病気 > 感染症・病気の随時提供情報 > 新型コロナウイルス感染症について > 新型コロナウイルス感染症対策　陽性患者数及び陽性患者の属性データ - 神奈川県"],[],["https://www.pref.niigata.lg.jp/site/shingata-corona/256362836.html","トップページ > 分類でさがす > くらし・安全・環境 > 防災 > 新型コロナウイルス感染症 > 県内の発生状況"],["http://www.pref.toyama.jp/cms_sec/1205/kj00021798.html","ホーム > 組織別案内 > 厚生部 健康課 > 新型コロナウイルス感染症の県内の患者等発生状況 - 富山県"],["https://stopcovid19.pref.ishikawa.jp/","新型コロナウイルス感染症対策サイト - 石川県"],["https://covid19-fukui.com/","新型コロナウイルス感染症対策サイト - 福井県"],["https://stopcovid19.yamanashi.dev/","新型コロナウイルス感染症対策サイト - 山梨県"],["https://www.pref.nagano.lg.jp/hoken-shippei/kenko/kenko/kansensho/joho/corona-doko.html",""],["https://www.pref.gifu.lg.jp/kinkyu-juyo-joho/shingata_corona_kansendoko.html#hassei","トップ >  緊急・重要情報 >  新型コロナウイルス感染症【県内の感染動向】について - 岐阜県"],["https://opendata.pref.shizuoka.jp/dataset/8167.html",""],["https://www.pref.aichi.jp/site/covid19-aichi/kansensya-kensa.html","ホーム > 健康・福祉 > 健康・医療 > 健康管理 > 愛知県新型コロナウイルス感染症対策サイト > 愛知県内の感染者・遺伝子検査件数 - 愛知県"],[],["https://www.pref.mie.lg.jp/YAKUMUS/HP/m0068000066_00002.htm","トップページ > 健康・福祉・子ども > 医療 > 感染症 > 三重県新型コロナウイルス感染症特設サイト > 新型コロナウイルス感染症の発生状況"],["https://www.pref.shiga.lg.jp/ippan/kenkouiryouhukushi/yakuzi/309252.html",""],["https://www.pref.kyoto.jp/kentai/news/novelcoronavirus.html#F","ホーム > 健康・福祉・人権 > 健康・医療 > 京都府の健康対策 > 感染症緊急情報 > 新型コロナウイルス感染症に関連する情報について - 京都府"],["http://www.pref.osaka.lg.jp/iryo/osakakansensho/corona.html","ホーム > 健康・医療 > 医療・医療費 > 大阪府感染症対策情報 > 新型コロナウイルス感染症について"],["https://web.pref.hyogo.lg.jp/kk03/corona_hasseijyokyo.html","ホーム > 暮らし・教育 > 健康・福祉 > 感染症 > 新型コロナウイルスに感染した患者の発生状況 - 兵庫県"],["http://www.pref.nara.jp/55168.htm",""],["https://www.pref.wakayama.lg.jp/prefg/000200/covid19.html",""],[],["https://www.pref.tottori.lg.jp/item/1207285.htm#itemid1207285",""],["https://www.pref.shimane.lg.jp/medical/yakuji/kansensyo/other/topics/bukan2020.html",""],["http://www.okayama-opendata.jp/opendata/ga120PreAction.action?keyTitle=d9c4776db7f09fff161953a2aaf03b80a9abad48&datasetId=e6b3c1d2-2f1f-4735-b36e-e45d36d94761",""],["https://www.pref.hiroshima.lg.jp/soshiki/57/bukan-coronavirus.html","トップページ 組織でさがす 健康福祉局 健康対策課 コロナウイルス感染症について - 広島県"],["https://yamaguchi-opendata.jp/ckan/dataset/f6e5cff9-ae43-4cd9-a398-085187277edf",""],[],["https://covid19-tokushima.netlify.app/","徳島県新型コロナウイルス感染症 非公式対策サイト"],["https://www.mhlw.go.jp/stf/newpage_10264.html",""],["https://www.pref.ehime.jp/opendata-catalog/dataset/2174.html",""],["http://www.pref.kochi.lg.jp/soshiki/111301/2020041300141.html",""],[],["https://www.pref.fukuoka.lg.jp/life/3/21/79/","ホーム > 感染症情報 > 福岡県内での発生状況 - 福岡県庁"],["https://www.pref.saga.lg.jp/kiji00373220/index.html","ホーム > 分類から探す > 健康・福祉 > 健康づくり > 感染症・インフルエンザ予防 >新型コロナウイルス感染症について - 佐賀県"],["https://www.pref.nagasaki.jp/bunrui/hukushi-hoken/kansensho/corona_nagasaki/corona_nagasaki_shousai/#hassei","ホーム > 分類で探す > 福祉・保健 > 感染症 > 新型コロナウイルス感染症について> 新型コロナウイルス感染症について（詳細情報）- 長崎県"],["https://www.pref.kumamoto.jp/kiji_32300.html","ホーム  ＞  分類から探す  ＞  健康・福祉  ＞  感染症・疾病対策  ＞  感染症情報  ＞  新型コロナウイルス感染症の県内の感染者発生状況 - 熊本県"],["http://www.pref.oita.jp/site/covid19-oita/covid19-pcr.html","トップページ > 新型コロナウイルスに関するお知らせ > 大分県におけるPCR検査実施人数及び患者状況 - 大分県"],["https://www.pref.miyazaki.lg.jp/kenko/hoken/kansensho/covid19/hassei.html","トップ > 健康・福祉 > 保健・健康づくり > 感染症対策 > 新型コロナウイルス感染症患者の発生状況 - 宮崎県"],["https://www.pref.kagoshima.jp/ae06/kenko-fukushi/kenko-iryo/kansen/kansensho/coronavirus.html#kokunai","ホーム > 健康・福祉 > 健康・医療 > 新型コロナウイルス感染症 > 新型コロナウイルス感染症に関する情報 - 鹿児島県"],["https://www.pref.okinawa.jp/site/hoken/chiikihoken/kekkaku/covid19_hasseijoukyou.html","ホーム > 組織で探す > 保健医療部 地域保健課 > 感染症対策業務について（結核感染症班） > 沖縄県における新型コロナウイルス感染症発生状況 - 沖縄県"]],JAPAN_REGIONS={"北海道・東北":["北海道","青森県","岩手県","宮城県","秋田県","山形県","福島県"],"関東":["茨城県","栃木県","群馬県","埼玉県","千葉県","東京都","神奈川県"],"中部":["新潟県","富山県","石川県","福井県","山梨県","長野県","岐阜県","静岡県","愛知県"],"近畿":["三重県","滋賀県","京都府","大阪府","兵庫県","奈良県","和歌山県"],"中国":["鳥取県","島根県","岡山県","広島県","山口県"],"四国":["徳島県","香川県","愛媛県","高知県"],"九州・沖縄":["福岡県","佐賀県","長崎県","熊本県","大分県","宮崎県","鹿児島県","沖縄県"]},getJapanResionData=(e,t)=>{let a=null;switch(e){case"世界":a="";break;case"日本":a=_.sumBy(_.values(m_.pref_tbl_last_m1),t);break;default:let n=JAPAN_REGIONS[e];n&&(a=0,_.map(m_.pref_tbl_last_m1,(e,r)=>{n.includes(r)&&(a+=e[t])}))}return a},initPrefTableData=()=>{let e=0;for(var t=0;t<m_.spk.bar_stacks.length;t++){let a=_.last(m_.spk.line[0][t]);e<a&&(e=a)}const a=m_.pref_tbl_last_m1["東京都"].n+1e5;let n=$("#tbl_pref");for(t=0;t<m_.spk.bar_stacks.length;t++){let r=_.last(m_.spk.line[0][t]),i=m_.spk.line[0][t][m_.spk.line[0][t].length-2],o=_.sum(_.last(m_.spk.bar_stacks[t])),l=parseInt(100*r/e);0===l&&0!==r&&(l=1);let c=n.find("#spn"+t+" td:eq(0)").text(),s=n.find("#spn"+t),m=m_.pref_tbl_last_m1[c].n,d=parseInt(100*m/a),p=_.round(100*r/m,3),h=parseInt(10*p*d);s.find("td:eq(1)").text(m).attr("title","感染率(感染者数/人口): "+p+"%").css({color:"#202020","vertical-align":"top"}).css({background:"linear-gradient(to right, "+COL_CND_C+" , "+COL_CND_C+" "+h+"%,#008080 "+h+"%, #008080 "+d+"%,#FFFFFF "+d+"%, #FFFFFF) center center / 100% 30% no-repeat"}),s.find("td:eq(2)").text(r).css({color:"#202020","vertical-align":"top"}).css({background:"linear-gradient(to right, #1f77b4 "+l+"%, #FFFFFF "+l+"% "+(100-l)+"%) center center / 100% 30% no-repeat"});let u=moment(m_.spk.max_ymd).subtract(1,"days").format("YYYY/MM/DD(ddd)");s.find("td:eq(3)").text(o),n.find("thead th:eq(3)").attr("title","感染者数 前日比("+u+"時点)");let f=m_.pref_tbl_last_m1[c],g=f?f.deaths:0,b=f?f.discharged:0,k=r-b-g,v=m_.pref_tbl_last_m2[c],w=v?v.deaths:0,D=i-(v?v.discharged:0)-w;s.find("td:eq(4)").text(g),s.find("td:eq(5)").text(b),s.find("td:eq(6)").text(k),s.find("td:eq(7)").text(k-D),n.find("thead th:eq(7)").attr("title","患者数 前日比("+u+"時点)")}},drawPrefSparkline=(e,t)=>{let a=$("#tbl_pref"),n=IS_SP?3:7,r=IS_SP?50:80,i=$("#tbl_pref tr:eq(3) td").length-1;for(var o=0;o<t.length;o++){let l=a.find("#spn"+o),c=_.last(m_.spk.line[0][o]),s=a.find("#spn"+o+" td:eq(0)").text(),m=l.find("td:eq("+i+")");m.sparkline(t[o],{type:"bar",barColor:"#1f77b4",barWidth:n,height:r,stackedBarColor:COL_CND,useropt:[s,o],tooltipFormatter(e,a,n){let r=a.userOptions.useropt[0];a.userOptions.useropt[1];return moment(m_.spk.max_ymd).subtract(t[0].length-(n[0].offset+1),"days").format("M/D(ddd)")+" - "+r+"<BR>─【新規】─────<BR>"+(0==n[4].value?"":'<span class="square" style="background:'+n[4].color+'"></span>無症,退院: '+n[4].value+"名<BR>")+(0==n[3].value?"":'<span class="square" style="background:'+n[3].color+'"></span>感染: '+n[3].value+"名<BR>")+(0==n[2].value?"":'<span class="square" style="background:'+n[2].color+'"></span>肺炎,入院: '+n[2].value+"名<BR>")+(0==n[1].value?"":'<span class="square" style="background:'+n[1].color+'"></span>酸投,重症: '+n[1].value+"名<BR>")+(0==n[0].value?"":'<span class="square" style="background:'+n[0].color+'"></span>死亡: '+n[0].value+"名<BR>")+"計: "+(n[4].value+n[3].value+n[2].value+n[1].value+n[0].value)+"名<BR>"}}),1!==e&&m.sparkline(m_.spk.out_of_100k[o],{composite:!0,lineColor:"#ffa07a",fillColor:!1,maxSpotColor:"",spotRadius:IS_SP?1.5:2,valueSpots:{"0.5:":"red"},chartRangeMax:1,lineWidth:1.5,tooltipFormatter(e,t,a){let n=a.y>=.5?"font-weight:bold;color:#FF0000;":"";return'<span class="ui-icon ui-icon-chart-line" style="background:#FFF;color:'+a.color+'"></span>10万人中 <span style="'+n+'">'+a.y+"</span>名<BR>─【累計】─────<BR>"}}),m.sparkline(m_.spk.line[0][o],{composite:!0,chartRangeMax:c+5,lineColor:"red",fillColor:"rgba(255,0,0,0.1)",useropt:[o],tooltipFormatter(e,t,a){let n=t.userOptions.useropt[0],r=m_.spk.line[0][n][a.x]-m_.spk.line[1][n][a.x];return"感染者: "+php_number_format(a.y)+'名<BR><span class="ui-icon ui-icon-chart-line" style="background:#FFF;color:'+a.color+'"></span>死亡: '+php_number_format(r)+"名<BR>"}}),m.sparkline(m_.spk.line[1][o],{composite:!0,chartRangeMax:c+5,lineColor:COL_CND_A,fillColor:"rgba(0,255,32,0.2)",useropt:[o],tooltipFormatter(e,t,a){let n=t.userOptions.useropt[0],r=m_.spk.line[1][n][a.x],i=m_.spk.line[2][n][a.x];return'<span class="ui-icon ui-icon-chart-line" style="background:#FFF;color:'+a.color+'"></span>退院: '+php_number_format(r-i)+"名<BR>"}}),m.sparkline(m_.spk.line[2][o],{composite:!0,chartRangeMax:c+5,lineColor:"blue",fillColor:"rgba(0,0,255,0.18)",useropt:[o],tooltipFormatter:(e,t,a)=>'<span class="ui-icon ui-icon-chart-line" style="background:#FFF;color:'+a.color+'"></span>患者: '+php_number_format(a.y)+"名"}),m.sparkline(m_.spk.vline[o].slice(SPARK_SX),{composite:!0,type:"bar",barColor:"rgba(255,0,0,1)",barWidth:1,barSpacing:n,height:r,chartRangeMax:1e3,colorMap:{1000:"rgba(255,0,0,0.9)",999:"rgba(0,0,255,0.9)"},tooltipFormatter:(e,t,a)=>"<BR>"+(1e3===a[0].value?"※緊急事態宣言 発令":999===a[0].value?"※緊急事態宣言 解除":"")})}},initPrefTable=()=>{initPrefTableData();for(var e=0;e<m_.spk.bar_stacks.length;e++)m_.spk.bar_stacks[e]=m_.spk.bar_stacks[e].slice(SPARK_SX),m_.spk.out_of_100k[e]=m_.spk.out_of_100k[e].slice(SPARK_SX),m_.spk.line[0][e]=m_.spk.line[0][e].slice(SPARK_SX),m_.spk.line[1][e]=m_.spk.line[1][e].slice(SPARK_SX),m_.spk.line[2][e]=m_.spk.line[2][e].slice(SPARK_SX);$("#container2_tbl_pref").show(),$("#tbl_pref").show(),drawPrefSparkline("first",m_.spk.bar_stacks),m_.tbl_pref=$("#tbl_pref").DataTable({stateSave:!0,order:[],searching:!0,paging:!1,scrollX:IS_SP,autoWidth:!1,info:!1,dom:'<"fg-toolbar ui-toolbar ui-widget-header ui-helper-clearfix ui-corner-tl ui-corner-tr"lfrB>t<"fg-toolbar ui-toolbar ui-widget-header ui-helper-clearfix ui-corner-bl ui-corner-br"ip>',buttons:[{text:'<i class="ui-icon ui-icon-arrowstop-1-s"></i><img title="テーブルのデータをCSV形式でダウンロードします。" width="20" src="img/csv.png">',extend:"csvHtml5",exportOptions:{columns:":visible"},filename:"covid19",charset:"utf-8",bom:!0,exportOptions:{columns:[0,1,2,3,4,5,6,7],format:{header:function(e,t,a){return"人口感染率"===a.textContent&&(a.textContent="人口"),a.textContent},body:function(e,t,a){return m_.tbl_pref.data()[t][a]}}}}],columns:[{render:function(e,t,a,n){let r=e;if("display"===t)if(PREF_DATA[n.row]&&PREF_DATA[n.row].length){let t=PREF_DATA[n.row][0],a=PREF_DATA[n.row][1],i=PREF_EN[e]?'<img src="img/japan/'+PREF_EN[e]+'.gif">':"";"日本"===e&&(i='<img src="img/world/Japan.png">'),"世界"===e&&(i='<i class="fa fa-globe" style="font-size:1.8em;"></i>'),r='<a target="_blank" href="'+t+'" title="'+a+'">'+i+e+"</a>"}else r=e;return r},orderable:!1},{visible:0,orderSequence:["desc","asc"],render:function(e,t,a,n){let r=e;if("display"===t){let t=m_.pref_tbl_last_m1[a[0]];if(t){let a=_.round(100*t.carriers/t.n,3);r=php_number_format(e)+"<BR>"+a+"%"}else{let e=getJapanResionData(a[0],"carriers");if(""===e)r="";else{let t=getJapanResionData(a[0],"n"),n=_.round(100*e/t,3);r=php_number_format(t)+"<BR>"+n+"%"}}}else r=e;return r}},{orderSequence:["desc","asc"],render:function(e,t,a,n){let r=e;if("display"===t){let t=getJapanResionData(a[0],"carriers");r=null===t?php_number_format(e):""===t?"":php_number_format(t)}else r=e;return r}},{render:function(e,t){return"display"===t?"0"===e||""===e?"":"▲"+e:e},orderSequence:["desc","asc"]},{visible:0,orderSequence:["desc","asc"]},{visible:0,orderSequence:["desc","asc"]},{visible:0,orderSequence:["desc","asc"]},{visible:0,render:function(e,t){return"display"===t?"0"===e||""===e?"":e>0?'<span style="color:orange">▲'+Math.abs(e)+"</span>":'<span style="color:green">▼'+Math.abs(e)+"</span>":"sort"===t&&""===e?1e4:e},orderSequence:["asc","desc"]},{orderable:!1}],initComplete:function(){let e=this.api(),t=$(e.table().container()).find("[type=search]");m_.tbl_pref_isearch=t.clone(),m_.tbl_pref_isearch.autocomplete_ex({user_opt:{data:m_.ac_data_tbl,multiple:1,select:function(e,t){m_.tbl_pref_isearch.val(m_.tbl_pref_isearch.val()+" "),m_.tbl_pref_isearch.trigger("keyup").focus()}}}).attr({id:"tbl_flt",placeholder:"自治体名でフィルタリング"}).on("keyup change clear",function(){let e=m_.tbl_pref_isearch.val().replace(/　/g," ").trim().split(" ");1==e.length?m_.tbl_pref.columns(0).search(e[0]).draw():e.length>1&&(reg_str="("+e.join("|")+")",m_.tbl_pref.columns(0).search(reg_str,!0).draw())}),t.before(m_.tbl_pref_isearch).remove(),m_.tbl_pref_isearch.addClass("btn_clear").btn_clear(),e.column(4).visible()&&$("#chk_tbl_detail").prop("checked",!0).checkboxradio("refresh");let a=[];e.rows(":visible").every(t=>{a.push(e.row(t).data()[0])}),a.length&&a.length!==PREF_DATA.length&&$("#tbl_flt").val(a.join(" "))},mark:{}}),IS_SP||$("#tbl_pref").sortable({axis:"y",placeholder:"ui-state-highlight",items:"tbody > tr",cursor:"move",handle:".uicm",revert:50})};$(document).ready(function(){$("#chk_tbl_detail").checkboxradio().on("click",function(){let e=$(this).prop("checked");m_.tbl_pref&&(m_.tbl_pref.column(1).visible(e),m_.tbl_pref.column(4).visible(e),m_.tbl_pref.column(5).visible(e),m_.tbl_pref.column(6).visible(e),m_.tbl_pref.column(7).visible(e))}),$("#chk_tbl_spkflt").checkboxradio().on("click",function(){$(this).prop("checked")?drawPrefSparkline(1,m_.createFilteredBarStacksData()):drawPrefSparkline(2,m_.spk.bar_stacks)})}),$(document).ready(function(){m_.loadAllData()});